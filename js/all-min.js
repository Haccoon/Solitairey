YUI.add("breakout",function(c){function b(f,e,d){return Math.max(Math.min(f,d),e)}function a(d){var f=d.rows,e=d.columns;this._host=d.host;this._container=c.Node.create("<div style='position: absolute'>");this._nodes=[];if(!(f||e)){f=8}this._rows=f;this._columns=e;a.superclass.constructor.apply(this,arguments)}a.NS="breakout";a.Name="Breakout";c.extend(a,c.Plugin.Base,{_splitNode:function(){var d,i,k,j,g=Math.round(this._blockWidth),n=Math.round(this._blockHeight),s=this._rows,h=this._columns,l=this._host.getXY(),o,f=this._container,e=this._nodes=[],q,p=c.Node.create('<div style="width: '+g+"px; height: "+n+'px; position: absolute; overflow: hidden">');f.setXY(l);for(d=0;d<s;d++){e[d]=q=[];j=d*n;for(i=0;i<h;i++){k=i*g;o=this._host.cloneNode(true);q[i]=p.cloneNode().setXY([k,j]).append(o.setXY([-k,-j]));f.append(q[i])}}this._swapIn()},_swapIn:function(){this._host.get("parentNode").append(this._container);this._host.setStyle("visibility","hidden")},_setup:function(){if(this._nodes.length){return}var g=this._host,f=parseFloat(g.getComputedStyle("width")),d=parseFloat(g.getComputedStyle("height")),i,j,h=this._rows,e=this._columns;if(h){j=d/h}if(e){i=f/e}if(!h){j=i;h=d/j}if(!e){i=j;e=f/i}this._container.setStyles({width:f,height:d});this._width=f;this._height=d;this._blockWidth=i;this._blockHeight=j;this._rows=h;this._columns=e;this._splitNode()},_forEach:function(p,q){this._setup();this._swapIn();var d,l,o=this._rows,g=this._columns,q=q||{},f=Math.abs(q.random||0),j=0,h,n,i,e=this._container,k=this;q.crop&&e.setStyle("overflow","hidden");for(d=0;d<o;d++){for(l=0;l<g;l++){j++;n=this._nodes[d][l];h=p.call(this,n,d,l,o,g);i=d+l;if(q.reverse){i=o+g-i}h.animation.on("end",function(){j--;if(!j){k._container.remove();q.unhide&&k._host.setStyle("visibility","visible");q.crop&&e.setStyle("overflow","visible");k.fire("end")}});(function(r){var t=1-(Math.random()*f),s;if(q.fade){s=q.unhide?0:1;c.mix(r.animation.get("from"),{opacity:s});c.mix(r.animation.get("to"),{opacity:1-s})}else{n.setStyle("opacity",1)}setTimeout(function(){r.animation.run()},r.interval*i*t)})(h)}}},explode:function(d){d=d||{};if(!("fade" in d)){d.fade=true}var e=Math.abs(d.random||0);this._forEach(function(i,q,j,r,k){var g=(d.distance||1.5)*2,l=d.duration||1000,n=d.easing||c.Easing.easeOutStrong,h=1-(Math.random()*e),f={x:(k-1)/2,y:(r-1)/2},p={x:j-f.x,y:q-f.y},o;g*=h;o={left:(p.x*g+f.x)*this._blockWidth,top:(p.y*g+f.y)*this._blockHeight};if(d.unhide){i.setStyles(o);o={left:j*this._blockWidth,top:q*this._blockHeight}}anim=new c.Anim({node:i,easing:n,to:o,duration:l/1000});return{animation:anim,interval:0}},d)},sheer:function(e){e=e||{};var h=e.distance||1,f=e.duration||1000,d=e.interval||0,g=e.easing||c.Easing.easeIn;this._forEach(function(j,s,k,t,l){var q=!(k%2),n=!(s%2),i=this._width,r=this._height,p={left:k*this._blockWidth,top:s*this._blockHeight},o={};if(l===1){q=n}if(t===1){n=!q}if(q){if(n){o.left=p.left-h*i}else{o.top=p.top+h*r}}else{if(n){o.top=p.top-h*r}else{o.left=p.left+h*i}}if(e.unhide){o=p}anim=new c.Anim({node:j,easing:g,to:o,duration:f/1000});return{animation:anim,interval:d}},e)},pinwheel:function(d){d=d||{};var g=d.distance||1,e=d.duration||1000,f=d.easing||c.Easing.easeOut;this._forEach(function(j,s,k,t,l){var q=!(k%2),n=!(s%2),i=0,h=this._blockWidth,r=this._blockHeight,p={left:k*h,top:s*r,width:h,height:r},o={};if(q){if(n){o.top=p.top+g*r}else{o.left=p.left+g*h}}if(q===n){o.height=r*(1-g)}else{o.width=h*(1-g)}if(d.unhide){o=p}anim=new c.Anim({node:j,easing:f,to:o,duration:e/1000});return{animation:anim,interval:i}},d)},disintegrate:function(d){d=d||{};d.reverse=true;this._forEach(function(g,o,h,p,i){var e=(d.distance||1.5)*this._height,k=d.duration||1000,l=d.easing||c.Easing.easeBoth,f=k/(p+i)*2,n=o*this._blockHeight,j;if(e<0){o=p-o-1}if(d.unhide){g.setStyle("top",n-e)}else{n+=e}j=new c.Anim({node:g,easing:l,to:{top:n},duration:k/1000});return{animation:j,interval:f}},d)},fadeOut:function(d){d=d||{};d.fade=true;this._forEach(function(f,l,g,n,h){var j=d.duration||700,o=d.unhide?0:1,k=d.easing,e,i;if(!k){k=d.unhide?c.Easing.easeOut:c.Easing.easeInStrong}e=j/(n+h)*2;i=new c.Anim({node:f,easing:k,from:{},to:{},duration:j/1000});return{animation:i,interval:e}},d)},_inverse:function(e,d){d=d||{};d.unhide=true;e.call(this,d)},unsheer:function(d){this._inverse(this.sheer,d)},unpinwheel:function(d){this._inverse(this.pinwheel,d)},converge:function(d){this._inverse(this.explode,d)},fadeIn:function(d){this._inverse(this.fadeOut,d)},build:function(d){this._inverse(this.disintegrate,d)}});c.Breakout=a},"1.0",{requires:["plugin","anim"]});YUI.add("save-manager",function(b){var a=b.Solitaire;SaveManager=b.namespace("Solitaire.SaveManager");b.mix(SaveManager,{nameKey:"current-game",serializedKey:"saved-game",save:function(c,e,d){e=e||"";c=c||"";localStorage[this.nameKey]=c;localStorage[d||this.serializedKey]=e},clear:function(c){localStorage[this.serializedKey||c]=""},getSavedGame:function(e){var c=localStorage[this.nameKey],f=localStorage[e||this.serializedKey],d=false;if(!c){c=b.Cookie.get("options");d=true}if(!f){f=b.Cookie.get("saved-game")||b.Cookie.get("initial-game");d=true}if(d){this.save(c,f);this.removeCookies()}return{name:c||"",serialized:f||""}},removeCookies:function(){b.Cookie.remove("options");b.Cookie.remove("saved-game");b.Cookie.remove("initial-game")}})},"0.0.1",{requires:["solitaire"]});YUI.add("analytics",function(f){var c=f.Solitaire,b=f.namespace("Solitaire.Analytics"),a=5,d=0,e,g=0;f.on("beforeSetup",function(){var h=g;g=new Date().getTime();if(h){b.track("Games","Played",e,g-h)}d=0;e=c.game.name()});f.on("win",function(){var h=new Date().getTime();b.track("Games","Won",c.game.name(),h-g,true);b.track("Games","Played",c.game.name(),h-g,true);g=0});f.on("endTurn",function(){d++;if(d===a){b.track("Games","New",c.game.name())}});f.on("popup",function(h){b.track("Menus","Show",h)});f.mix(b,{track:function(j,i,h,l,k){if(typeof _gaq==="undefined"){return}_gaq.push(["_trackEvent",j,i,h,l,k])}})},"1.0.0",{requires:["solitaire"]});YUI.add("ads",function(Y){function writer(adContainer){var buffer="",container=document.createElement("div");return function(str){var last,element,content;buffer+=str;last=str[str.length-1];if(last!=="\n"&&last!==">"){return}container.innerHTML=buffer;element=container.childNodes[0];if(!element){return}if(element.nodeName==="SCRIPT"){if(element.src!==""){loadScript(element.src,adContainer)}else{content=element.childNodes[0].nodeValue;content=content.match(/[^<!\-\/]+/)[0];eval(content)}}else{adContainer.appendChild(element)}buffer=""}}function loadScript(url,container,callback){var script=document.createElement("script");script.onload=function(){if(typeof callback==="function"){callback()}};script.src=url;container.appendChild(script)}function loadAd(container,callback){var url="http://ads.adbrite.com/mb/text_group.php?sid=2093964&zs=3136305f363030&ifr="+AdBrite_Iframe+"&ref="+AdBrite_Referrer;loadScript(url,container,callback)}function configLeftSkyscraper(){AdBrite_Title_Color="0000FF";AdBrite_Text_Color="000000";AdBrite_Background_Color="FFFFFF";AdBrite_Border_Color="CCCCCC";AdBrite_URL_Color="008000";try{AdBrite_Iframe=window.top!=window.self?2:1;AdBrite_Referrer=document.referrer==""?document.location:document.referrer;AdBrite_Referrer=encodeURIComponent(AdBrite_Referrer)}catch(e){AdBrite_Iframe="";AdBrite_Referrer=""}}function loadLeft(){var left=document.getElementById("adleft");if(!left){return}left.innerHTML="";configLeftSkyscraper();loadAd(left);document.write=document.writeln=writer(left)}function loadLigit(){var url="liji.html";document.getElementById("adleftbody").src=url}Y.on("newGame",loadLigit);Y.on("loadGame",loadLigit)},"1.0.0",{requires:["solitaire"]});if(!Array.prototype.indexOf){Array.prototype.indexOf=function(b){var a=this.length>>>0;var c=Number(arguments[1])||0;c=(c<0)?Math.ceil(c):Math.floor(c);if(c<0){c+=a}for(;c<a;c++){if(c in this&&this[c]===b){return c}}return -1}}Array.prototype.flatten=function(){var b=[],c,a,e,d=Array.prototype;for(c=0,a=this.length;c<a;c++){e=this[c];if(Object.prototype.toString.call(e)==="[object Array]"){d.push.apply(b,d.flatten.call(e))}else{b.push(e)}}return b};function argsArray(a){return Array.prototype.slice.call(a)}Array.prototype.last=function(){return this[this.length-1]};Array.prototype.deleteItem=function(b){var a=this.indexOf(b);a!==-1&&this.splice(a,1)};Array.prototype.shuffle=function(){var b=this.length,d,c,a;while(--b){d=~~(Math.random()*b);c=this[b];a=this[d];this[d]=c;this[b]=a}};Function.prototype.bind=function(b){var a=this;return function(){var c=argsArray(arguments);return a.apply(b,c)}};Function.prototype.partial=function(){var b=this,a=argsArray(arguments);return function(){var e,c,d=[].concat(a);for(e=0,c=arguments.length;e<c;e++){d.push(arguments[e])}return b.apply(this,d)}};function instance(c,b){var a=new Function(),e,d;a.prototype=c;e=new a;if(typeof b==="object"){for(d in b){if(b.hasOwnProperty(d)){e[d]=b[d]}}}return e}function normalize(a){var b=typeof a==="function"?a():a;return isNaN(b)?undefined:b}Object.prototype.mapToFloat=function(){var a;for(a in this){if(this.hasOwnProperty(a)){this[a]=parseFloat(this[a])}}return this};Object.prototype.mapAppend=function(b){var a;for(a in this){if(this.hasOwnProperty(a)){this[a]+=b}}return this};var Game;YUI.add("solitaire",function(d){var b=d.namespace("Solitaire");function a(e){a.superclass.constructor.call(this,e)}d.extend(a,d.DD.Delegate,{getCard:function(){return this.get("currentNode").getData("target")}});d.mix(b,{activeCard:null,moves:null,selector:"body",offset:{left:50,top:70},padding:{x:50,y:50},widthScale:0,noop:function(){},name:function(){var e;for(e in b){if(b.hasOwnProperty(e)&&b[e]===Game){return e}}},container:function(){return d.one(b.selector)},width:function(){return this.Card.base.width*this.widthScale},height:function(){return this.Card.base.height*4.2},maxStackHeight:function(){return b.Application.windowHeight-normalize(this.Tableau.stackConfig.layout.top)-normalize(Game.offset.top)},undo:function(){d.fire("undo")},pushUndoStack:function(){b.moves.length&&c.push(b.moves);b.moves=[]},pushMove:function(f){var e=b.moves;e&&e.push(f)},serialize:function(){var j=[],k=[],h,g,f,e;d.Array.each(this.fields,function(i){g=this[i.toLowerCase()].stacks;for(f=0,e=g.length;f<e;f++){h=g[f].serialize();j.push(h);k.push(String.fromCharCode(h.length))}},this);return[String.fromCharCode(j.length)].concat(k,j).join("")},stationary:function(f){var e=Game.Card.updatePosition;Game.Card.updatePosition=b.noop;f.call(this);Game.Card.updatePosition=e},unanimated:function(g){var f=d.Solitaire.Animation,e=f.animate;f.animate=false;g.call(this);f.animate=e},withoutFlip:function(i){var g=b.Animation,f=b.Card,h=g.flip,e=f.setImageSrc;if(!g.animate){i.call(this);return}g.flip=f.setImageSrc=b.noop;i.call(this);g.flip=h;f.setImageSrc=e},unserialize:function(e){this.unanimated(function(){var f=e.charCodeAt(0),j=e.substr(1,f),k=f+1,n,o=this.fields,r=-1,h=[],q,p,l,g;for(l=0,q=0;l<f;l++,q++,k+=g){g=j.charCodeAt(l);n=e.substr(k,g);if(q===h.length){r++;h=this[o[r].toLowerCase()].stacks;q=0}p=h[q];p.unserialize(n);p.updateCardsPosition()}})},save:function(e){var f;if(e){f="initial-game"}d.Solitaire.SaveManager.save(this.name(),this.serialize(),f)},loadGame:function(e){this.unanimated(function(){this.setup(function(){this.unserialize(e)})});d.fire("loadGame");this.save()},newGame:function(){d.Solitaire.SaveManager.clear();this.withoutFlip(function(){this.setup(this.deal)});d.fire("newGame");this.save(true)},cleanup:function(){d.Event.purgeElement(this.container());d.detach("solitaire|*");this.eachStack(function(e){e.cleanup()})},setup:function(e){Game=b.game=this;d.fire("beforeSetup");b.moves=null;c.clear();this.stationary(function(){this.init();d.Solitaire.Animation.initQueue();this.createStacks();this.createEvents();this.createDraggables();e.call(this)});b.moves=[];d.fire("afterSetup");d.Solitaire.Animation.dealing=true;Game.eachStack(function(f){f.updateCardsStyle();f.updateCardsPosition()});d.Solitaire.Animation.dealing=false},createEvents:function(){var e=d.one(b.selector);e.delegate("dblclick",Game.autoPlay,".card");e.delegate("contextmenu",Game.autoPlay,".card");e.delegate("click",Game.Events.click,".card");e.delegate("touchend",Game.Events.click,".card");d.after("solitaire|endTurn",Game.Events.endTurn);d.on("solitaire|undo",Game.Events.undo)},createDraggables:function(){var e=new a({dragConfig:{dragMode:"intersect",groups:["open"],clickPixelThresh:0},container:b.selector,nodes:".card"});e.dd.plug(d.Plugin.DDProxy,{borderStyle:"none",moveOnEnd:false});e.on("drag:drag",Game.Events.drag);e.on("drag:mouseDown",Game.Events.dragCheck);e.on("drag:start",Game.Events.dragStart);e.on("drag:dropmiss",Game.Events.dragMiss);e.on("drag:drophit",Game.Events.drop);e.on("drag:end",Game.Events.dragEnd)},createField:function(l){if(!l){return}var k=instance(l),n,g,j,h,e;if(l.stackConfig){n=l.stackConfig.layout;j=new Array(l.stackConfig.total);l.Stack.field=l.field;for(h=0,e=j.length;h<e;h++){g=instance(l.Stack);g.configLayout=n;g.layout(d.merge(n,{hoffset:h*n.hspacing||0,voffset:h*n.vspacing||0}),h);j[h]=g}}k.stacks=j;typeof k.init==="function"&&k.init();return k},createStacks:function(){this.eachStack(function(e){e.cards=[];e.createNode()})},eachStack:function(f,e){Game&&d.Array.each(Game.fields,function(h){var g=h.toLowerCase(),i=Game[g],j=e||g;j===g&&i.stacks&&d.Array.each(i.stacks,f)})},resize:function(g,f,e){this.scale(g);this.unanimated(function(){this.eachStack(function(h,j){var l=h.cards,k=h.configLayout;h.adjustRankHeight();h.cards=[];h.layout(d.merge(k,{hoffset:j*k.hspacing||0,voffset:j*k.vspacing||0}),j);h.setImageSrc();h.updateStyle();h.setCards(l.length,function(o){var n=l[o];if(n){n.setImageSrc();n.updateStyle()}return n});h.update()})})},scale:function(g){var e=d.Solitaire.Card,f=e.base,h;e.scale=g;for(h in f){if(f.hasOwnProperty(h)){e[h]=f[h]*g}}},init:function(){var g=b.preventDefault,f,h,e;d.on("selectstart",g,document);d.on("contextmenu",function(j){var i=j.target;if(i.hasClass("stack")||i.hasClass("card")){j.preventDefault()}},document);this.scale(1);e=d.Array.map(Game.fields,function(i){return Game[i.toLowerCase()]=Game.createField(Game[i])});if(Game.fields.indexOf("Deck"===-1)){Game.deck=Game.createField(Game.Deck)}f=Math.min.apply(Math,d.Array.map(e,function(i){return d.Array.map(i.stacks,function(j){return j.left})}).flatten());h=Math.max.apply(Math,d.Array.map(e,function(i){return d.Array.map(i.stacks,function(j){return j.left})}).flatten())+this.Card.width;this.widthScale=(h-f)/this.Card.base.width},preventDefault:function(f){f.preventDefault()},autoPlay:function(){var e=typeof this.getCard==="function"?this.getCard():this.getData("target");e.autoPlay()},isWon:function(){var k=this.foundation.stacks,f=this.deck,h,j=0,g,e;h=f.suits.length*13*f.count;for(g=0,e=k.length;g<e;g++){j+=k[g].cards.length}return j===h},win:function(){d.fire("win");d.Solitaire.SaveManager.save(this.name())},endTurn:function(){d.fire("endTurn")}});d.Solitaire.Events={click:function(g){var f=g.target.getData("target");if(f.dragging){return}f.dragging=false;f.turnOver(g);b.moves.reverse();Game.endTurn();g.preventDefault()},clickEmptyDeck:function(){Game.redeal();b.moves.reverse();Game.endTurn()},drag:function(){this.getCard().dragging=true},dragCheck:function(){var f=this.getCard(),e=f.createProxyStack();if(!e){return}b.activeCard=f;Game.eachStack(function(g){g.updateDragGroups()})},dragStart:function(){var e=this.getCard(),g=this.get("dragNode"),f=e.createProxyNode();if(f){g.setContent(f);!e.proxyStack&&d.one(".yui3-dd-shim").setStyle("cursor","not-allowed")}},dragMiss:function(){var e=this.getCard();Game.unanimated(function(){e.updatePosition()})},dragEnd:function(){var j=this.getCard(),n=b.container(),k=new d.Node(document.createDocumentFragment()),g,h,i=this.dd.realXY,o=n.getXY(),e,l,f=j.proxyStack;j.dragging=false;g=this.get("dragNode");h=g.get("firstChild");h&&h.remove();if(!f){return}e=f.cards;l=j.stack;f.left=i[0]-o[0];f.top=i[1]-o[1];Game.unanimated(function(){f.updateCardsPosition()});d.Array.each(e,function(p){if(!p){return}p.proxyStack=null;k.append(p.node)});n.append(k);l.updateCardsPosition()},drop:function(h){if(!b.activeCard){return}var f=b.activeCard.proxyStack,g,i;if(f){i=f.first();g=h.drop.get("node").getData("target");g=g.stack||g;if((f.cards.length===1&&i.validTarget(g))||f.validTarget(g)){g.pushStack(f)}}Game.endTurn()},endTurn:function(){b.pushUndoStack();b.activeCard=null;Game.eachStack(function(e){e.updateCardsStyle()});if(Game.isWon()){Game.win()}else{Game.save()}},undo:function(){var e=argsArray(arguments);e.unshift("endTurn");c.undo();d.fire.apply(d,e)}};d.Solitaire.Deck={count:1,suits:["c","d","h","s"],init:function(f){var g=this.suits,j,h,k,i,e=Game.Card;this.cards=[];for(i=0;i<this.count;i++){for(k=1;k<=13;k++){for(h=0;j=g[h];h++){this.cards.push(e.create(k,j).faceDown())}}}if(f===undefined){this.cards.shuffle()}else{this.msSeededShuffle(f)}},msSeededShuffle:function(e){var k=this.cards,g=Math.pow(2,31),j,f,h;for(h=k.length;h>1;h--){e=((214013*e)%g+2531011)%g;j=(e>>16)&32767;item=k[h-1];f=k[j%h];k[h-1]=f;k[j%h]=item}},createStack:function(){var e;for(e=this.cards.length-1;e>=0;e--){this.stacks[0].push(this.cards[e])}},last:function(){return this.cards.last()},pop:function(){return this.cards.pop()}};d.Solitaire.Card={zIndex:1,index:-1,width:null,height:null,rankHeight:null,hiddenRankHeight:null,isFaceDown:false,positioned:false,scale:1,stack:null,proxyStack:null,ghost:true,dragging:false,node:null,callback:null,left:0,top:0,base:{},origin:{left:function(){var e=b.container().getX();return -e-d.Solitaire.Card.width},top:function(){var e=b.container().getY();return -e-d.Solitaire.Card.height}},animSpeeds:{slow:0.5,mid:0.2,fast:0.1},create:function(g,f){var e={c:0,s:0,h:1,d:1};return instance(this,{rank:g,suit:f,color:e[f]})},truncatePosition:function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top)},faceDown:function(e){this.isFaceDown=true;this.setRankHeight();b.Animation.flip(this);e||b.pushMove({card:this,faceDown:true});return this},faceUp:function(e){this.isFaceDown=false;this.setRankHeight();b.Animation.flip(this);e||b.pushMove({card:this,faceDown:false});return this},setRankHeight:function(){var e=this.stack,f,g;if(e&&e.rankHeight){f=e.rankHeight;g=e.hiddenRankHeight}else{f=b.Card.rankHeight;g=b.Card.hiddenRankHeight}this.rankHeight=this.isFaceDown?g:f},imageSrc:function(){var e=this.base.theme+"/";e+=this.isFaceDown?"facedown":this.suit+this.rank;e+=".png";return e},setImageSrc:function(){var e=this.node;e&&e.setAttribute("src",this.imageSrc())},wrapperStyle:function(){return{left:this.left,top:this.top,width:Math.floor(this.width),height:Math.floor(this.height)}},updateStyle:function(){var e=this.node;e&&e.setStyles(this.wrapperStyle());this.setRankHeight()},turnOver:function(g){if(!this.isFaceDown){return}var f=this.stack;if(f.field==="deck"){Game.turnOver()}else{if(this.isFree()){this.faceUp()}}g.stopPropagation()},autoPlay:function(h){var f=this.stack,l=f.last(),k,g,j,e;if(this.isFaceDown||f.field==="foundation"){return}k=Game.foundation.stacks;for(j=0,e=k.length;j<e;j++){g=k[j];if(this.isFree()&&this.validTarget(g)){if(!h){this.moveTo(g);f.updateCardsPosition();f.update();Game.endTurn()}return true}}return false},ensureDOM:function(){!this.node&&this.createNode()},isFree:function(){return this===this.stack.last()},playable:function(){return this.stack.field==="deck"||(this.isFree()&&(this.stack.field!=="foundation"))},createNode:function(){var e;e=this.node=d.Node.create("<img class='card'>").setData("target",this).setAttribute("src",this.imageSrc()).plug(d.Plugin.Drop);e.setStyles({left:-this.width,top:-this.height});this.setRankHeight();b.container().append(e)},destroyNode:function(){var e=this.node;e&&e.clearData().destroy(true)},createProxyStack:function(){if(this.isFaceDown||this.stack.field==="foundation"){this.proxyStack=null;return null}var f=instance(this.stack,{proxy:true,stack:this.stack}),j=f.cards,g,h,e;f.cards=[];f.push(this,true);for(h=j.indexOf(this)+1,e=j.length;h<e;h++){g=j[h];if(f.validProxy(g)){f.push(g,true)}else{break}}this.proxyStack=h===e?f:null;return this.proxyStack},proxyCards:function(){return this.proxyStack.cards},createProxyNode:function(){var f=d.Node.create("<div>"),e=this.proxyStack;if(!e){if(!this.ghost){return null}f.setStyles({opacity:0.6,top:-this.top,left:-this.left}).append(this.node.cloneNode(true))}else{f.setStyles({opacity:1,top:-this.top,left:-this.left});d.Array.each(this.proxyCards(),function(g){g.proxyStack=e;f.append(g.node)})}return f},updatePosition:function(e){if(!this.node){return}var g={left:Math.floor(this.left)+"px",top:Math.floor(this.top)+"px",zIndex:this.zIndex},f=this.origin;if(!this.positioned){this.node.setStyles({left:normalize(f.left),top:normalize(f.top)})}d.Solitaire.Animation.init(this,g,e)},pushPosition:function(){var e=this.index>=0?this.index:this.stack.cards.indexOf(this);b.pushMove({card:this,index:e,from:this.stack})},moveTo:function(e){var f=this.stack;this.pushPosition();f.deleteItem(this);e.push(this);d.fire(f.field+":afterPop",f);return this},flipPostMove:function(e){var f=b.Animation;if(e===undefined){e=f.interval*20}this.after(function(){f.flip(this,e)})},after:function(e){this.callback=e},runCallback:function(){if(this.callback){this.callback.call(this);this.callback=null}}};d.Solitaire.Stack={cards:null,node:null,images:{tableau:"freeslot.png",deck:"freeslot.png",reserve:"freeslot.png",foundation:"freeslot.png"},serialize:function(){var h,e,k=this.cards,g,f=Game.deck.suits,l,j=[];for(h=0,e=k.length;h<e;h++){g=k[h];if(g){l=f.indexOf(g.suit)|g.rank<<2|g.isFaceDown<<6}else{l=128}j.push(String.fromCharCode(l))}return j.join("")},eachCard:function(h){var f,e,g=this.cards;for(f=0,e=g.length;f<e;f++){if(g[f]){if(h.call(this,g[f],f)===false){return false}}}return true},setCards:function(j,f){var h,e,g,l,k=instance(Game.Card,{updatePosition:b.noop,ensureDOM:b.noop});l=this.cards=[];for(h=0;h<j;h++){g=f.call(this,h)||k;this.push(g)}for(h=0;h<j;h++){if(l[h]===k){l[h]=null}}},updateCardsPosition:function(){var e=this.cards;Game.stationary(function(){this.proxy||this.adjustRankHeight();this.setCards(e.length,function(g){var f=e[g];if(f){f.stack=this;f.setRankHeight()}return f})}.bind(this));this.eachCard(function(f){f.updatePosition()})},updateCardsStyle:function(){var e=this.field;e==="foundation"||this.eachCard(function(f){if(f.playable()){f.node.addClass("playable")}else{f.node.removeClass("playable")}})},unserialize:function(g){var f=Game.deck,e=Game.Card;this.setCards(g.length,function(j){var k,h;k=g.charCodeAt(j);if(k===128){h=null}else{h=e.create((k>>2)&15,f.suits[k&3]);k&64?h.faceDown(true):h.faceUp(true)}return h});this.update()},imageSrc:function(){var e=this.images[this.field];return e?b.Card.base.theme+"/"+e:"trans.gif"},layout:function(i){var h=i.hoffset*d.Solitaire.Card.width,f=i.voffset*d.Solitaire.Card.height,g=Game.offset,e=this;d.Array.each(["top","left"],function(j){e[j]=normalize(i[j])});this.left+=h+normalize(g.left);this.top+=f+normalize(g.top)},deleteItem:function(e){this.cards.deleteItem(e)},push:function(f,e){var g=this.last(),i=this.field,h=f.stack?f.stack.field:"deck";if(g){f.zIndex=g.zIndex+1}else{if(i==="deck"||i==="foundation"){f.zIndex=200}else{if(h==="deck"){f.zIndex=Game.Card.zIndex}}}if(!e){f.stack=this;this.setCardPosition(f);f.truncatePosition();f.ensureDOM()}this.cards.push(f);e||f.updatePosition({from:h,to:i})},pushStack:function(g){var f=b.activeCard.stack,e=this;f.eachCard(function(h,j){h.index=j});Game.stationary(function(){g.eachCard(function(h){h.moveTo(e);h.index=-1});f.eachCard(function(h){h.index=-1})});f.updateCardsPosition();f.update();d.fire(e.field+":afterPush",e)},maxStackHeight:function(){return Game.maxStackHeight()},adjustRankHeight:function(){var f=this.cards,k,t=this.last(),s=this.maxStackHeight(),q=0,h=0,j=0,l=0,u,r=0,p=b.Card,e=0,g=0,n,o;if(f.length<=1){return}for(n=0,o=f.length-1;n<o;n++){if(!f[n]){return}if(f[n].isFaceDown){e++;j+=p.hiddenRankHeight}else{g++;l+=p.rankHeight}}if(t){r=j+l+t.height;u=s-t.height}if(r<=s){this.rankHeight=0;this.hiddenRankHeight=0;return}j=u*j/(j+l);l=u*l/(j+l);this.hiddenRankHeight=e?Math.floor(j/e):0;this.rankHeight=g?Math.floor(l/g):0},first:function(){return this.cards[0]},last:function(){return this.cards.last()},length:function(){return this.cards.length},index:function(){return Game[this.field].stacks.indexOf(this)},next:function(){return Game[this.field].stacks[this.index()+1]},setCardPosition:function(e){e.top=this.top;e.left=isNaN(this.left)?null:this.left},wrapperStyle:function(){return{left:Math.floor(this.left),top:Math.floor(this.top),width:Math.floor(d.Solitaire.Card.width),height:Math.floor(d.Solitaire.Card.height)}},updateStyle:function(){var e=this.node;e&&e.setStyles(this.wrapperStyle())},setImageSrc:function(){if(this.node){this.node.setAttribute("src",this.imageSrc())}},createNode:function(){var e=this.node;e=this.node=d.Node.create("<img class='stack'>").set("draggable",false).setData("target",this).plug(d.Plugin.Drop);this.setImageSrc();this.updateStyle();b.container().append(e)},cleanup:function(){var e=this.node;e&&e.clearData().destroy(true);this.eachCard(function(f){f.destroyNode()})},updateDragGroups:function(){var j=b.activeCard,h=this.cards,g=this.last(),e,f=h.length-1;this.eachCard(function(i){i.node.drop.removeFromGroup("open")});if(j.validTarget(this)){if(g){g.node.drop.addToGroup("open")}this.node.drop.addToGroup("open")}else{this.node.drop.removeFromGroup("open")}},validCard:function(){return true},validProxy:function(e){return e&&e.validTarget(this)&&this.validCard(e)},update:function(){}};d.Solitaire.Animation={animate:true,dealing:false,duration:0.5,flipDuration:0.1,interval:20,queue:new d.AsyncQueue(),initQueue:function(){var e=this.queue;e.defaults.timeout=this.interval},init:function(g,n,j){if(!this.animate){g.node.setStyles(n);g.positioned=true;setTimeout(function(){g.runCallback()},0);return}var f=g.node,e=this.queue,i=g.animSpeeds,o={top:f.getStyle("top"),left:f.getStyle("left")}.mapToFloat().mapAppend("px"),l=n.zIndex,h,k=this;if(o.top===n.top&&o.left===n.left){return}if(this.dealing){h=i.slow}else{if(!j||j.from===j.to||j.to==="waste"||j.to==="foundation"){h=i.fast}else{if(j.from==="deck"){h=i.slow}else{h=i.mid}}}f.setStyle("zIndex",500+l);delete n.zIndex;e.add(this.animFunction.bind(this).partial({left:n.left,top:n.top,easing:"ease-out",duration:h},g,function(){g.positioned=true;f.setStyle("zIndex",g.zIndex)}));e.run()},animFunction:function(){},doTransition:function(f,e,i){var g=e.node,h=this;g.transition(f,function(){i();h.clearTransition(g);e.runCallback()})},doAnim:function(f,e,l){var g=e.node,j=f.duration,i={linear:"linear","ease-out":"easeOut","ease-in":"easeIn"},k=d.Easing[i[f.easing]],h;delete f.duration;delete f.easing;h=new d.Anim({node:g,to:f,duration:j,easing:k});h.on("end",function(){l();e.runCallback()});h.run()},flip:function(f,e){if(!(this.animate&&f.node)){f.setImageSrc();return}var g=this;setTimeout(function(){var i=f.node,k=g.flipDuration,l="linear",j=Math.floor(f.left),h=Math.floor(f.width);g.animFunction({left:Math.floor(j+h/2)+"px",width:0,easing:l,duration:k},f,function(){f.setImageSrc();g.animFunction({left:j+"px",width:h+"px",easing:l,duration:k},f,function(){f.updateStyle()})})},e||0)},clearTransition:function(f){var e=f._node.style;d.Array.each(["Webkit","Moz","O","MS"],function(h){var g=h+"Transition";if(g in e){e[g]=null}})}};b.Animation.animFunction=b.Animation.doAnim;var c={stack:null,clear:function(){this.stack=[]},push:function(e){this.stack.push(e)},pop:function(){return this.stack.pop()||[]},undo:function(){var e;e=d.Array.unique(d.Array.map(this.pop(),this.act).flatten());d.Array.each(e,function(f){if(f){f.updateCardsPosition();f.update(true)}})},act:function(e){if(typeof e==="function"){e();return[]}var i=e.from,f=e.card,h=f.stack,g=h.cards;if(i){if(i===f.stack){g[g.indexOf(f)]=null}else{g.deleteItem(f)}i.cards[e.index]=f;f.stack=i;b.container().append(f.node)}if("faceDown" in e){e.faceDown?f.faceUp(true):f.faceDown(true)}return[h,i]}}},"0.0.1",{requires:["save-manager","dd","dd-plugin","dd-delegate","anim","transition","async-queue","cookie","array-extras"]});YUI.add("analytics",function(f){var c=f.Solitaire,b=f.namespace("Solitaire.Analytics"),a=5,d=0,e,g=0;f.on("beforeSetup",function(){var h=g;g=new Date().getTime();if(h){b.track("Games","Played",e,g-h)}d=0;e=c.game.name()});f.on("win",function(){var h=new Date().getTime();b.track("Games","Won",c.game.name(),h-g,true);b.track("Games","Played",c.game.name(),h-g,true);g=0});f.on("endTurn",function(){d++;if(d===a){b.track("Games","New",c.game.name())}});f.on("popup",function(h){b.track("Menus","Show",h)});f.mix(b,{track:function(j,i,h,l,k){if(typeof _gaq==="undefined"){return}_gaq.push(["_trackEvent",j,i,h,l,k])}})},"1.0.0",{requires:["solitaire"]});YUI.add("util",function(b){var a=b.Solitaire;Util=b.namespace("Solitaire.Util");b.mix(Util,{flipStacks:function(f,e,d){var c=a.game;if(e===undefined){e=200}if(d===undefined){d=150}f.after(function(){c.eachStack(function(g){setTimeout(function(){g.eachCard(function(h){if(!h.isFaceDown){a.Animation.flip(h)}})},e);e+=d},"tableau")})},moveWasteToDeck:function(){var c=this.deck.stacks[0],d=this.waste.stacks[0];while(d.cards.length){d.last().faceDown().moveTo(c)}},hasFreeTableaus:function(){return b.Array.some(a.game.tableau.stacks,function(c){return !c.cards.length})},freeTableaus:function(){return b.Array.filter(a.game.tableau.stacks,function(c){return c.cards.length===0})},seedRank:function(){var c=Game.foundation.stacks[0].first();return c?c.rank:0},cacheNode:function(c){var d;return function(){if(!d){d=b.one(c)}return d}},mapRank:function(e){var d={1:"Ace",11:"Jack",12:"Queen",13:"King"},c=d[e];return c?c:e}})},"0.0.1",{requires:["solitaire","array-extras"]});YUI.add("win-display",function(c){var t,h,k=true,o=c.Solitaire,e=o.Statistics,j=c.namespace("Solitaire.WinDisplay"),l,w=false,r=o.Util.cacheNode,q=[],b=r("body"),i=r("#win-display"),p=r("#win-display-game"),a=r("#win-display-streak"),n=r("#win-display-wins"),s=r("#win-display-loses");c.on("newGame",function(){h=false});c.on("loadGame",function(){h=false});c.on("win",function(){if(h||!k){return}h=true;q[~~(Math.random()*q.length)]()});c.on("beforeSetup",function(){j.cancel();j.enable();f.clear()});c.on("fieldResize",function(){f.resize()});var g=(function(){var x=16;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(y){setTimeout(y,x)}})();var f={width:0,height:0,angle:2*Math.PI,velocity:1000,minYVelocity:200,gravity:15,dampening:0.5,canvas:null,context:null,actors:[],bounce:function(E,C,J){var D=E.node,K=D.getXY(),A={},F,H,B,G,x,I,z=new Date().getTime(),y;H=this.angle*(1-C);B=this.angle-H;F=Math.random()*B+H;x=this.velocity*(1-J);I=this.velocity-x;G=Math.random()*I+x;A.x=Math.cos(F)*G;A.y=Math.sin(F)*G;D.remove();y=this.actors.length===0;if(K){this.actors.push({node:D._node,velocity:A,boundingbox:{x:K[0],y:K[1],width:~~E.width,height:~~E.height},lastUpdate:z,lastSmear:z})}if(y){this.bounceCallback(z)}},bounceCallback:function(C){var x=new Date().getTime(),B,A=this.actors,z,y;B=x-C;y=0;while(z=A[y]){if(this.bounceStep(z.node,z.velocity,z.boundingbox,B)){A.splice(y,1)}else{y++}}if(A.length>0){g(function(){this.bounceCallback(x)}.bind(this))}},bounceStep:function(A,y,z,x){x/=1000;z.x+=y.x*x;z.y+=y.y*x;y.y+=this.gravity;if(z.x>this.width||z.x+z.width<0||z.y+z.height<0){return true}if(z.y+z.height>=this.height){z.y-=y.y*x;y.y*=-this.dampening;y.y=Math.min(y.y,-this.minYVelocity)}this.context.drawImage(A,~~z.x,~~z.y,z.width,z.height)},createSmearNode:function(){var x;if(!this.canvas){var x=document.createElement("canvas");x.style.zIndex=-1;x.style.position="absolute";x.style.top="0px";x.style.left="0px";x.width=this.width;x.height=this.height;this.canvas=x;this.context=x.getContext("2d");b().appendChild(this.canvas)}this.canvas.className=""},resize:function(){this.width=b().get("winWidth");this.height=b().get("winHeight");if(this.canvas){this.canvas.width=this.width;this.canvas.height=this.height}},init:function(){this.resize();this.createSmearNode()},clear:function(){if(!this.context){return}this.context.clearRect(0,0,this.width,this.height);this.canvas.className="hidden";this.actors=[]}};function v(){if(w){return}var y=o.Application,x=o.game.name();c.on("click",function(){j.cancel();setTimeout(function(){y.newGame()},0)},c.one("#win-display .new_deal"));c.on("click",function(){y.GameChooser.show(true)},c.one("#win-display .choose_game"));w=true}function u(){var y=300,z=1000,x=1000;f.init();Game.eachStack(function(A){var B=A.length();A.eachCard(function(D,C){D.node.setStyle("zIndex",C-B);setTimeout(function(){f.bounce(D,0.8,0.2)},~~(x*(A.cards.length-1-C)+Math.random()*x+y))})},"foundation");j.winDisplay(z)}function d(){var y=500,z=900,x=900;Game.eachStack(function(A){A.eachCard(function(B){if(!B){return}var C=B.node;if(B!==A.last()){setTimeout(function(D){D.addClass("hidden")}.partial(C),y);return}C.plug(c.Breakout,{columns:5});(function(D){setTimeout(function(){D.breakout.explode({random:0.65,duration:z})},y)})(C);y+=x})},"foundation");j.winDisplay(y+200)}c.mix(j,{winDisplay:function(x){l=setTimeout(function(){var z=o.game.name(),y=e.getRecord(z);v();p().set("text",o.Application.nameMap[z]);a().set("text",y.streaks().last().length);n().set("text",y.wins().length);s().set("text",y.loses().length);i().removeClass("hidden")},x)},cancel:function(){i().addClass("hidden");clearTimeout(l)},enable:function(){k=true},disable:function(){k=false}});q.push(d);if(window.HTMLCanvasElement){q.push(u)}},"0.0.1",{requires:["solitaire","statistics","util","array-extras","breakout"]});YUI.add("solitaire-ios",function(e){return;if(!e.UA.ios){return}var p=e.Solitaire,r=p.scale,s=0,h=1,u={hspacing:0,vspacing:0,left:0,top:0},c={scale:1,offset:60,maxStackHeight:155},v={Agnes:{offset:[null,5],maxStackHeight:260},FlowerGarden:{offset:[-60,5],maxStackHeight:235},Freecell:{scale:[1,0.93],offset:[35,5]},Golf:{scale:[1.1,1],offset:[45,8]},GClock:{scale:0.93,offset:5,maxStackHeight:130},Klondike:{offset:[null,5],maxStackHeight:[null,340]},MonteCarlo:{scale:[0.88,1],offset:[80,15]},Pyramid:{offset:20},Scorpion:{offset:5,maxStackHeight:[235,380]},Spider:{scale:[1.13,0.79],offset:[5,2],maxStackHeight:[160,340]},TriTowers:{scale:0.9,offset:10},Yukon:{scale:[0.95,1],offset:[50,5],maxStackHeight:[235,390]}},k={Agnes:function(){var z={hspacing:1.13};l(this,"Reserve",e.merge(z,{top:60}));l(this,"Tableau",e.merge(z,{top:145}));l(this,"Foundation",e.merge(z,{left:135}))},FlowerGarden:[function(){this.Card.rankHeight=15;l(this,"Reserve",{top:0,left:70});l(this,"Foundation",{top:0,left:470,hspacing:0,vspacing:1.1});l(this,"Tableau",{top:0,left:140});e.mix(this.Reserve.Stack,{setCardPosition:function(z){var A=this.cards.last(),C=A?A.top+11:this.top,B=this.left;z.left=B;z.top=C},update:p.noop},true)},function(){var z=p.FlowerGarden.Reserve.Stack.setCardPosition;return function(){l(this,"Tableau",{left:10,top:120});l(this,"Reserve",{left:17,top:60});l(this,"Foundation",{left:55,top:0,hspacing:1.5,vspacing:0});e.mix(this.Reserve.Stack,{setCardPosition:z,update:p.noop},true)}}()],Freecell:[x("Freecell",["Foundation","Reserve","Tableau"]),function(){var z={hspacing:1.05};l(this,"Tableau",z);l(this,"Reserve",z);l(this,"Foundation",e.merge(z,{left:157}))}],Golf:[x("Golf",["Tableau","Foundation"]),function(){l(this,"Tableau",{hspacing:1.1});l(this,"Foundation",{left:132})}],GClock:function(){l(this,"Foundation",{left:143});l(this,"Tableau",{left:0,top:250,hspacing:1.05})},Klondike:[function(){x("Klondike","Foundation").call(this);x("Klondike","Tableau").call(this)},function(){e.mix(this.Foundation.stackConfig.layout,{left:135,hspacing:1.13},true);e.mix(this.Tableau.stackConfig.layout,{hspacing:1.13},true)}],MonteCarlo:function(){l(this,"Tableau",{cardGap:1.1,vspacing:1.05})},Pyramid:[function(){var z=x("Pyramid","Deck");var A=x("Pyramid","Waste");return function(){z.call(this);A.call(this);e.mix(this.Tableau.stackConfig.layout,{left:190,cardGap:1.1,hspacing:-0.55},true)}}(),function(){e.mix(this.Deck.stackConfig.layout,{left:-10,top:300},true);e.mix(this.Waste.stackConfig.layout,{top:300},true);e.mix(this.Tableau.stackConfig.layout,{left:120,cardGap:1.1,hspacing:-0.55},true)}],Scorpion:[function(){l(this,"Deck",{top:0,left:0});l(this,"Foundation",{top:0,left:420,hspacing:0,vspacing:1.1});l(this,"Tableau",{left:60,top:0,hspacing:1.13})},function(){l(this,"Deck",{left:10,top:0});l(this,"Foundation",{left:75,top:0,hspacing:1.5,vspacing:0});l(this,"Tableau",{left:0,top:60,hspacing:1.13})}],Spider:[function(){l(this,"Foundation",{left:94,hspacing:1.05});l(this,"Tableau",{top:65,hspacing:1.05})},function(){l(this,"Foundation",{left:62,hspacing:1});l(this,"Tableau",{hspacing:1})}],TriTowers:function(){e.mix(this.Tableau.stackConfig.layout,{hspacing:-0.5,rowGaps:[3,2,1,0],cardGap:1},true)},RussianSolitaire:[x("RussianSolitaire",["Tableau","Foundation"]),function(){l(this,"Tableau",{top:55,hspacing:1.13});l(this,"Foundation",{left:46,top:0,hspacing:1.5,vspacing:0})}],Yukon:[x("Yukon",["Tableau","Foundation"]),function(){l(this,"Tableau",{top:55,hspacing:1.13});l(this,"Foundation",{left:46,top:0,hspacing:1.5,vspacing:0})}]};v.FortyThieves=v.Spider1S=v.Spider2S=v.Spider;k.FortyThieves=k.Spider1S=k.Spider2S=k.Spider;v.WillOTheWisp=v.Spiderette=v.Klondike1T=v.Klondike;k.WillOTheWisp=k.Spiderette=k.Klondike1T=k.Klondike;v.RussianSolitaire=v.Yukon;e.mix(e.DD.DDM,{useHash:false,_pg_activate:p.noop,_pg_size:function(){}},true);e.DD.DDM.set("throttleTime",40);e.mix(e.DD.Drop.prototype,{_activateShim:function(){var z=e.DD.DDM;if(!z.activeDrag){return false}if(this.get("node")===z.activeDrag.get("node")){return false}if(this.get("lock")){return false}if(this.inGroup(z.activeDrag.get("groups"))){z._addValid(this);this.overTarget=false;if(!this.get("useShim")){this.shim=this.get("node")}this.sizeShim()}else{z._removeValid(this)}},_deactivateShim:function(){this.overTarget=false}},true);p.Statistics.winDisplay=function(){alert("You win!")};p.scale=p.noop;p.Card.ghost=false;p.Animation.animate=false;function l(z,B,A){e.mix(z[B].stackConfig.layout,A,true)}function x(A,z){var B,C=function(D){return[D,e.merge(u,p[A][D].stackConfig.layout)]};B=e.Array.map(e.Array(z),C);return function(){var D=this;e.each(B,function(E){e.mix(D[E[0]].stackConfig.layout,E[1],true)})}}function b(){var z=p.name(),A;if(k.hasOwnProperty(z)){A=o(k[z]);A.call(p.game)}}function o(A){var z=window.innerWidth===480?s:h,B;if(!A.length){return A}B=A[z];return B?B:A[s]}function n(B){var z=p.name(),A=v[z],D=c[B],C=A?A[B]:D;return o(C?C:D)||D}function y(){r.call(p.game,n("scale"))}function i(){return n("offset")}function g(){return n("maxStackHeight")}function a(A){var z=A.target;if(z.hasClass("stack")||z.hasClass("card")){return}A.preventDefault()}function j(){function z(A){return{deleteSelector:function(C){var D=document.styleSheets[A],E,B;if(!D){return}E=Array.prototype.splice.call(D.rules,0);B=E.indexOf(E.filter(function(F){return F.selectorText===C})[0]);if(B!==-1){D.deleteRule(B)}}}}z(0).deleteSelector("#menu li:hover")}function f(z){if(z.target.test("#descriptions *")){return}z.preventDefault()}function t(){var B,E,C,G,A,F,D,z=function(){G.removeClass("show")};j();G=e.one("#menu");A=e.one("body");B=e.one("#undo");D=e.one("#social");F=e.Node.create("<nav id=navbar>");C=e.Node.create("<a id=show_menu class='button'>New Game</a>");E=e.Node.create("<li class=cancel><a id='cancel'>Cancel</a></li>");B.get("parentNode").remove();C.on("click",function(){G.addClass("show")});G.append(E);F.append(C);if(D){navigator.onLine?F.append(D):D.remove()}F.append(B.addClass("button"));A.append(F);e.on("click",z,["#cancel","#new_deal","#restart"]);p.Application.GameChooser.draggable=false;e.one("#game-chooser .titlebar").append(document.createTextNode("Games"));e.one("#game-chooser .close").append(document.createTextNode("Back"));e.delegate("touchstart",function(H){H.target.ancestor("li",true).addClass("hover")},"#descriptions","li");e.delegate("touchend",function(H){H.target.ancestor("li",true).removeClass("hover")},"#descriptions","li");e.on("gamechooser:select",function(H){H.choose();z()});e.on("gamechooser:hide",function(){w()});if(navigator.standalone){A.addClass("fullscreen")}p.Application.resizeEvent="orientationchange"}function d(A){var z=e.one("body"),C,B;if(A){C="portrait";B="landscape"}else{C="landscape";B="portrait"}z.removeClass(C).addClass(B)}function q(){var z=p.name(),B=window.innerWidth===480,A=g();d(B);b();p.offset={left:i(),top:10};p.maxStackHeight=function(){return A};y()}function w(){setTimeout(function(){scrollTo(0,0)},10)}e.on("beforeSetup",q);e.on("beforeResize",q);e.on("afterResize",w);e.on("load",w);e.on("touchstart",function(z){if(z.target._node===document.body){z.preventDefault()}},document);e.on("touchmove",f,document);e.on("domready",t);p.padding={x:5,y:5};p.offset={left:5,top:5}},"0.0.1",{requires:["solitaire","statistics"]});YUI.add("auto-stack-clear",function(b){var a=b.Solitaire;b.namespace("Solitaire.AutoStackClear");a.AutoStackClear.register=function(){b.on("solitaire|tableau:afterPush",function(e){d(e,c)})};function d(e,n){var k=e.cards,l,j,g,f,h;if(!k.length){return false}for(h=k.length-1,l=1,j=k[h].suit;h>=0&&l<14;h--,l++){g=k[h];if(g.isFaceDown||g.rank!==l||g.suit!==j){return false}}f=l===14;f&&typeof n==="function"&&n(e,h+1);return f}function c(e,i){var f,h=e.cards,g=h.length-i;a.pushUndoStack();f=b.Array.find(a.game.foundation.stacks,function(j){return !j.cards.length});a.stationary(function(){while(g){h.last().moveTo(f);g--}});e.updateCardsPosition()}},"0.0.1",{requires:["solitaire"]});YUI.add("auto-turnover",function(c){c.namespace("Solitaire.AutoTurnover");var b=c.Solitaire.AutoTurnover,a=true;c.on("tableau:afterPop",function(d){if(!a){return}c.Array.each(d.cards,function(e){if(e&&e.isFaceDown&&e.isFree()){e.faceUp()}})});c.mix(b,{enable:function(){a=true},disable:function(){a=false},isEnabled:function(){return a}})},"0.0.1",{requires:["solitaire"]});YUI.add("solitaire-autoplay",function(h){h.namespace("Solitaire.Autoplay");var d=h.Solitaire,f=d.Autoplay,g=true,b=null,a=["Klondike","Klondike1T","FortyThieves","GClock","Freecell","FlowerGarden","Yukon","BakersGame","BakersDozen","Eightoff","LaBelleLucie","TheFan","Alternations","DoubleKlondike","KingAlbert"];h.on("endTurn",function(){if(!g||a.indexOf(d.game.name())===-1){return}if(b===null&&e()){h.fire("autoPlay")}});h.on("win",function(){clearInterval(b);b=null});h.on("autoPlay",function(){b=setInterval(c,130)});function c(){var i=false;d.game.eachStack(function(j){var k=j.field;if(i||k==="foundation"||k==="deck"){return}i=!j.eachCard(function(l){return !l.autoPlay()})})}function e(){var i=false;d.game.eachStack(function(j){var l=j.field,k=14,n;if(i||l!=="tableau"&&l!=="waste"){return}n=j.eachCard(function(o){if(o.rank>k||o.isFaceDown){i=true;return false}else{k=o.rank}})});return !i}h.mix(f,{enable:function(){g=true},disable:function(){g=false},isEnabled:function(){return g}})},"0.0.1",{requires:["solitaire"]});YUI.add("solitaire-background-fix",function(d){var c;d.on("load",b);d.on("resize",b);function b(){var g=a().get("winWidth"),e=a().get("winHeight"),f=document.body.style;if(!d.UA.mobile){a().setStyles({width:g,height:e})}if(f.backgroundSize===undefined&&f.MozBackgroundSize===undefined){a().setStyles({backgroundImage:"url(greentiled.jpg)",backgroundRepeat:"repeat"})}}function a(){if(!c){c=new d.Node(document.body)}return c}},"0.0.1",{requires:["solitaire"]});YUI.add("statistics",function(d){var w,l,o=true,z=window.localStorage,p=d.Solitaire,g=d.namespace("Solitaire.Statistics"),C=false,s=p.Util.cacheNode,c,u=(function(){var D=false;return function(){if(D){i().addClass("hidden");return}var G=[],I=p.Application.nameMap,F=new d.Node(document.createDocumentFragment()),H,E;for(H in I){if(!I.hasOwnProperty(H)){continue}G.push([H,I[H]])}G.sort(function(K,J){return K[1].localeCompare(J[1])});d.Array.each(G,function(J){var K=d.Node.create("<li class=stats-gameli>"+J[1]+"</li>");K.setData("game",J[0]);F.appendChild(K)});i().appendChild(F);D=true}})(),r=s("#stats-popup"),f=s(".stats-title"),A=s("#stats-game"),i=s("#stats-popup .popup-title-content"),t=s("#stats-winpercentage"),v=s("#stats-wins"),B=s("#stats-loses"),k=s("#stats-currentstreak"),y=s("#stats-beststreak"),a=s("#stats-gamesplayed");if(!z){return}d.on("newGame",function(){if(w){n(w)}l=false;w=null});d.on("loadGame",function(){w=p.game.name();l=false});d.on("endTurn",function(){if(!w){w=p.game.name()}});d.on("win",function(){if(l||!o){return}j(w);w=null;l=true});function x(){if(C){return}var D=p.Application;d.on("click",function(){i().toggleClass("hidden")},f());d.on("click",function(){if(!c){c=p.game.name()}D.Confirmation.show("Are you sure you want to reset all "+p.Application.nameMap[c]+" stats?",function(){q(c);g.statsDisplay(c)})},d.one("#stats-reset"));d.delegate("click",function(E){c=E.target.getData("game");g.statsDisplay(c)},i(),".stats-gameli");C=true}function e(G,E){var F,D;E=E||p.game.name();F=h(E);D=z[F]||"";D+=new Date().getTime()+"_"+G+"|";z[F]=D}function n(D){e(0,D)}function j(D){e(1,D)}function q(D){z[h(D)]=""}function h(D){return D+"record"}function b(E){var F=z[h(E)];function H(){if(!F||F===""){return[]}var I=F.split("|");I.splice(I.length-1);return d.Array.map(I,function(J){J=J.split("_");return{date:new Date(J[0]),won:!!parseInt(J[1],10)}})}function G(I){return I.won}var D=H();return{streaks:function(){var J=[],I=null;d.Array.each(D,function(K){if(!K.won){I&&J.push(I);I=null}else{if(!I){I=[]}I.push(K)}});I&&J.push(I);return J},wins:function(){return d.Array.filter(D,G)},loses:function(){return d.Array.reject(D,G)},all:function(){return D}}}d.mix(g,{statsDisplay:function(D){var G=typeof D==="string"?D:p.game.name(),I=b(G),L=I.streaks(),M=I.all(),J=I.wins(),F=M.length?J.length/M.length*100:0,E,K=0,H=0;if(!L.length){H=K=0}else{E=I.all().last();if(E&&E.won){K=L.last().length}H=L.sort(function(O,N){return O.length-N.length}).last().length}x();a().set("text",M.length);A().set("text",p.Application.nameMap[G]);t().set("text",Math.floor(F)+"%");v().set("text",J.length);B().set("text",I.loses().length);k().set("text",K);y().set("text",H);u();d.fire("popup","Stats")},getRecord:function(D){return b(D)},enable:function(){o=true},disable:function(){o=false}})},"0.0.1",{requires:["solitaire","util","array-extras","breakout"]});YUI.add("display-seed-value",function(e){var c=e.Solitaire,d=c.Util,a=["Agnes","Canfield"],b=d.cacheNode("#seed-value-bar"),f=d.cacheNode("#seed-value");e.namespace("Solitaire.DisplaySeedValue");e.on("afterSetup",function(){if(Game&&a.indexOf(Game.name())!==-1){f().setContent(d.mapRank(d.seedRank()));b().removeClass("hidden")}else{b().addClass("hidden")}});e.on("fieldResize",function(i,h,g){if(h<=1185){b().addClass("bottom")}else{b().removeClass("bottom")}})},"0.0.1",{requires:["solitaire","util"]});YUI.add("solver-freecell",function(a){a.namespace("Solitaire.Solver.Freecell");a.mix(a.Solitaire.Solver.Freecell,{enable:a.Solitaire.noop,disable:a.Solitaire.noop,isEnabled:function(){return false}});if(!(window.Worker&&window.ArrayBuffer&&window.Uint8Array)){return}var d=a.Solitaire,k=d.Solver.Freecell,b={s:0,h:1,c:2,d:3},l=true;function h(q){return q?q.rank<<2|b[q.suit]:0}function o(q){return q>>2}function e(q){return["s","h","c","d"][q&3]}function p(r,q){return q[0]-r[0]}function f(q){return a.Array.map(q.stacks,function(r){return r}).sort(function(t,r){var u=t.first(),s=r.first();return h(u)-h(s)})}function g(r){var q,s,t;t=a.Array.map(f(r.tableau),function(v){var u=[];v.eachCard(function(x,w){u[w]=h(x)});return[u,v.cards.length]});q=[];a.Array.forEach(f(r.reserve),function(v,u){q[u]=h(v.last())});s=[];a.Array.forEach(f(r.foundation),function(v,u){s[u]=h(v.last())});return{reserve:q,foundation:s,tableau:t}}function c(r,q){var v=q.source,t=q.dest,u,s={};u=v[1];r.eachStack(function(w){if(s.card){return}var x=w.last();if(!x){return}if(x.rank===o(u)&&x.suit===e(u)){s.card=x}},v[0]);u=t[1];r.eachStack(function(w){if(s.stack){return}var x=w.last();if(!(x||u)){s.stack=w}if(x&&(x.rank===o(u)&&x.suit===e(u))){s.stack=w}},t[0]);return s}function j(q,s){var r=a.one(q);if(r){s(r)}}var i={interval:500,timer:null,remainingMoves:null,init:function(q){var r=q;while(r){if(r.next){r.next.prev=r}r=r.next}this.remainingMoves=q},pause:function(){d.Autoplay.enable();window.clearTimeout(this.timer);this.timer=null;j("#solver-bar .pause",function(q){q.removeClass("pause");q.addClass("play")})},playCurrent:function(s){var q,t,r;if(!this.remainingMoves){return}q=c(s,this.remainingMoves);t=q.card;if(!t){return}r=t.stack;t.after(function(){r.updateCardsPosition();q.stack.updateCardsPosition()});t.moveTo(q.stack)},prev:function(q){var r=this.remainingMoves.prev;if(r){a.fire("undo",true);this.remainingMoves=r}},next:function(q){var s=this.remainingMoves,r=this.remainingMoves.next;d.Statistics.disable();d.WinDisplay.disable();this.playCurrent(q);if(r){this.remainingMoves=r}a.fire("endTurn",true)},play:function(s){var q,t,r;if(!this.remainingMoves){return}d.Autoplay.disable();j("#solver-bar .play",function(u){u.removeClass("play");u.addClass("pause")});this.next(s);this.timer=window.setTimeout(function(){this.play(s)}.bind(this),this.interval)}};var n={bar:null,indicator:null,indicatorTimer:null,indicatorInterval:750,delay:400,updateIndicator:function(s){var q=this.indicator,r,t;if(!q){return}s=((s||0)%4);t="Solving";for(r=0;r<s;r++){t+="."}q.set("text",t);this.indicatorTimer=window.setTimeout(this.updateIndicator.partial(s+1).bind(this),this.indicatorInterval)},stopIndicator:function(r){var q=this.indicator;window.clearTimeout(this.indicatorTimer);if(!q){return}if(r){q.set("text","Solution found");j("#solver-bar .controls",function(s){s.removeClass("hidden")})}else{q.set("text","Unable to find solution")}this.indicatorTimer=null},show:function(){if(a.one("#solver-bar")){return}var v=a.Node.create("<div id=solver-bar></div>"),q=a.Node.create("<span class=indicator>"),t=a.Node.create("<div class=fastforward>"),u=a.Node.create("<div class=rewind>"),w=a.Node.create("<div class=play>"),r=a.Node.create("<div class='controls hidden'>"),s;t.on("click",function(){i.next(Game)});u.on("click",function(){i.prev(Game)});w.on("click",function(){if(this.hasClass("play")){i.play(Game)}else{if(this.hasClass("pause")){i.pause()}}});r.append(u);r.append(w);r.append(t);v.append(q);v.append(r);a.one("body").append(v);this.indicator=q;this.bar=v},hide:function(){if(this.bar){this.bar.remove()}}};a.mix(k,{currentSolution:null,worker:null,attached:false,supportedGames:["Freecell"],isSupported:function(){return Game&&this.supportedGames.indexOf(Game.name())!==-1},enable:function(){l=true;this.resume()},disable:function(){l=false;this.suspend()},resume:function(q){if(!(l&&this.isSupported())){return}this.createUI();this.attachEvents();if(!q){this.solve()}},suspend:function(){if(this.worker){this.worker.terminate()}n.hide()},isEnabled:function(){return l},attachEvents:function(){if(this.attached){return}var q=i.pause.bind(i);a.on("afterSetup",function(){if(this.isSupported()){this.solve()}else{this.suspend()}}.bind(this));a.on("endTurn",function(r){if(r||!this.isSupported()){return}this.solve()}.bind(this));a.on("autoPlay",function(){k.suspend()});a.on("win",function(){k.suspend()});document.documentElement.addEventListener("mousedown",function(r){if(r.target.className.match(/\bpause\b/)){return}q()},true);this.attached=true},createUI:function(){n.show()},stop:function(){if(this.worker){this.worker.terminate()}},solve:function(){if(!l){return}this.stop();j("#solver-bar .controls",function(q){q.addClass("hidden")});this.currentSolution=null;this.worker=new Worker("js/solver-freecell-worker.js");this.worker.onmessage=function(r){var q=this.currentSolution=r.data.solution;i.init(q);if(q){n.stopIndicator(true)}else{n.stopIndicator(false)}}.bind(this);this.worker.postMessage({action:"solve",param:g(Game)});window.clearTimeout(n.indicatorTimer);n.indicatorTimer=window.setTimeout(n.updateIndicator.bind(n),n.delay)}},true);a.on("beforeSetup",function(){k.resume(true)})},"0.0.1",{requires:["solitaire","statistics","win-display"]});YUI.add("agnes",function(f){function e(h,g){return(h+1)%13===g%13}var d=f.Solitaire,b=d.Klondike,a=d.Util.seedRank,c=d.Agnes=instance(b,{fields:["Foundation","Deck","Waste","Tableau","Reserve"],height:function(){return this.Card.base.height*5.6},maxStackHeight:function(){return this.Card.height*2.75},deal:function(){var g=this.deck.stacks[0],i=this.foundation.stacks[0],h;b.deal.call(this);h=g.last();h.moveTo(i);h.faceUp();h.flipPostMove();this.turnOver()},redeal:d.noop,turnOver:function(){var g=this.deck.stacks[0],o=this.reserve.stacks,l=this.waste.stacks,n,p,h,k=[],j;if(g.cards.length<7){n=2;p=l}else{n=7;p=o}this.withoutFlip(function(){for(j=0;j<n;j++){h=g.last();h.moveTo(p[j]);h.faceUp();k.push(h);if(j===n-1){h.after(function(){f.Array.forEach(k,function(i){d.Animation.flip(i)})})}}})},Waste:instance(b.Waste,{stackConfig:{total:2,layout:{hspacing:1.5,top:0,left:0}},Stack:instance(d.Stack,{setCardPosition:function(g){var h=this.last(),j=this.top,i=h?h.left+d.Card.width*1.5:this.left;g.top=j;g.left=i}})}),Reserve:{field:"reserve",stackConfig:{total:7,layout:{hspacing:1.25,left:0,top:function(){return d.Card.height*4.4}}},Stack:instance(b.Stack,{images:{},setCardPosition:function(g){var h=this.last(),j=h?h.top+h.rankHeight:this.top,i=this.left;g.top=j;g.left=i}})},Card:instance(b.Card,{playable:function(){if(this.stack.field==="reserve"){return this.isFree()}else{return b.Card.playable.call(this)}},validTarget:function(g){var h=g.last();switch(g.field){case"tableau":if(!h){return this.validFreeTableauTarget()}else{return !h.isFaceDown&&h.color!==this.color&&e(this.rank,h.rank)}case"foundation":return this.validFoundationTarget(h);default:return false}},validFreeTableauTarget:function(){return e(this.rank,a())},validFoundationTarget:function(g){if(!g){return this.rank===a()}else{return this.suit===g.suit&&this.rank%13===(g.rank+1)%13}}})})},"0.0.1",{requires:["klondike","util"]});YUI.add("golf",function(c){var b=c.Solitaire,a=c.Solitaire.Golf=instance(b,{fields:["Deck","Foundation","Tableau"],deal:function(){var g,d,h=this.tableau.stacks,e=this.deck,f=this.foundation.stacks[0],i;for(i=0;i<5;i++){for(d=0;d<7;d++){g=e.pop();h[d].push(g);g.faceUp().flipPostMove(b.Animation.interval*40)}}g=e.pop();f.push(g);g.faceUp().flipPostMove(b.Animation.interval*100);e.createStack()},turnOver:function(){var d=this.deck.stacks[0],e=this.foundation.stacks[0],f=d.last();if(f){this.withoutFlip(function(){f.faceUp().moveTo(e);f.after(function(){b.Animation.flip(f)})})}},isWon:function(){var d=true;this.eachStack(function(e){e.eachCard(function(f){if(f){d=false}return d})},"tableau");return d},height:function(){return this.Card.base.height*4},Deck:instance(b.Deck,{field:"deck",stackConfig:{total:1,layout:{hspacing:0,top:function(){return b.Card.height*3},left:0}},createStack:function(){var e,d;for(e=0,d=this.cards.length;e<d;e++){this.stacks[0].push(this.cards[e])}}}),Tableau:{field:"tableau",stackConfig:{total:7,layout:{hspacing:1.25,top:0,left:0}}},Foundation:{field:"foundation",stackConfig:{total:1,layout:{hspacing:0,top:function(){return b.Card.height*3},left:function(){return b.Card.width*3.75}}}},Events:instance(b.Events,{dragCheck:function(d){this.getCard().autoPlay();this._afterDragEnd();d.halt()}}),Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"tableau":return this.autoPlay(true);case"deck":return this===this.stack.last();case"foundation":return false}},validTarget:function(d){if(d.field!=="foundation"){return false}var f=d.last(),e=Math.abs(this.rank-f.rank);return e===1},isFree:function(){return !this.isFaceDown&&this===this.stack.last()}}),Stack:instance(b.Stack,{images:{}})},true);c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)});c.mix(a.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true);c.mix(a.Deck.Stack,{setCardPosition:function(d){var e=this.last(),g,f,h;g=this.top;if(e){f=e.left+d.width*0.1;h=e.zIndex+1}else{f=this.left;h=0}d.top=g;d.left=f;d.zIndex=h}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("klondike",function(c){var b=c.Solitaire,a=c.Solitaire.Klondike=instance(b,{fields:["Foundation","Deck","Waste","Tableau"],cardsPerTurnOver:3,deal:function(){var g,e=0,f=this.deck,h=this.tableau.stacks,d=h.length-1,i=b.Animation;while(d>=0){g=f.pop();g.flipPostMove();h[(h.length-1)-d].push(g);g.faceUp();for(e=h.length-d;e<h.length;e++){g=f.pop();h[e].push(g)}d--}f.createStack()},turnOver:function(){var e=this.deck.stacks[0],k=this.waste.stacks[0],l=a.Card.updatePosition,d=b.game.Card,f,j=[],h,g;d.updatePosition=b.noop;this.withoutFlip(function(){for(h=e.cards.length,g=h-this.cardsPerTurnOver;h>g&&h;h--){f=e.last();j.push(f);f.faceUp();if(h===g+1||h===1){f.after(function(){c.Array.forEach(j,function(i){b.Animation.flip(i)})})}f.moveTo(k)}});d.updatePosition=l;k.eachCard(function(i){i.updatePosition()})},redeal:b.Util.moveWasteToDeck,Stack:instance(b.Stack),Foundation:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*3.75}}},field:"foundation"},Deck:instance(b.Deck,{stackConfig:{total:1,layout:{hspacing:0,top:0,left:0}},field:"deck"}),Waste:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return b.Card.width*1.5}}},field:"waste"},Tableau:{stackConfig:{total:7,layout:{hspacing:1.25,top:function(){return b.Card.height*1.5},left:0}},field:"tableau"},Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"tableau":return !this.isFaceDown;case"foundation":return false;case"waste":return this.isFree();case"deck":return true}},validFoundationTarget:function(d){if(!d){return this.rank===1}else{return d.suit===this.suit&&d.rank===this.rank-1}},validTarget:function(e){var f,d;if(e.field){f=e.last();d=e}else{f=e;d=e.stack}switch(d.field){case"tableau":if(!f){return this.rank===13}else{return !f.isFaceDown&&f.color!==this.color&&f.rank===this.rank+1}case"foundation":return this.validFoundationTarget(f);default:return false}}})});c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)});c.mix(a.Stack,{validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)}},true);c.mix(a.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true);c.mix(a.Waste.Stack,{setCardPosition:function(e){var g=this.cards,f=g.last(),d=this;c.Array.each(g.slice(-2),function(h,j){h.left=d.left;h.top=d.top});if(!g.length){e.left=d.left}if(g.length===1){e.left=d.left+0.2*e.width}else{if(g.length>1){f.left=d.left+0.2*e.width;f.top=d.top;e.left=d.left+0.4*e.width}}e.top=d.top}},true);c.mix(a.Deck.Stack,{createNode:function(){b.Stack.createNode.call(this);this.node.on("click",b.Events.clickEmptyDeck);this.node.addClass("playable")}},true)},"0.0.1",{requires:["util"]});YUI.add("klondike1t",function(d){var c=d.Solitaire,b=c.Klondike,a=c.Klondike1T=instance(b,{cardsPerTurnOver:1,redeal:c.noop,Waste:instance(b.Waste,{Stack:instance(c.Stack)}),Deck:instance(b.Deck,{Stack:instance(b.Deck.Stack,{createNode:function(){b.Deck.Stack.createNode.call(this);this.node.removeClass("playable")}})})})},"0.0.1",{requires:["klondike"]});YUI.add("flower-garden",function(d){var a=0,b=d.Solitaire,c=b.Util,e=d.Solitaire.FlowerGarden=instance(b,{offset:{left:function(){return b.Card.base.width*1.5},top:70},fields:["Foundation","Reserve","Tableau"],deal:function(){var j,h=this.deck,g=this.reserve.stacks[0],f=0,k,l=this.tableau.stacks;for(k=0;k<36;k++){j=h.pop();j.origin={left:j.width*1.25*(k%6),top:-j.height};l[f].push(j);j.faceUp();j.flipPostMove(0);f++;if(f===6){f=0}}j.after(function(){b.Animation.flip(this);setTimeout(function(){g.eachCard(function(i){b.Animation.flip(i)})},b.Animation.interval*20)});while(j=h.pop()){g.push(j);j.faceUp()}},height:function(){return this.Card.base.height*5.5},maxStackHeight:function(){return this.Card.height*3.1},Stack:instance(b.Stack),Foundation:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*1.25}}},field:"foundation",draggable:false},Reserve:{stackConfig:{total:1,layout:{hspacing:1.25,top:function(){return b.Card.height*4.5},left:function(){return b.Card.width*0.2}}},field:"reserve",draggable:true},Tableau:{stackConfig:{total:6,layout:{hspacing:1.25,top:function(){return b.Card.height*1.25},left:0}},field:"tableau",draggable:true},Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"foundation":return false;case"tableau":return this.createProxyStack();case"reserve":return true}},createProxyStack:function(){var f;switch(this.stack.field){case"foundation":this.proxyStack=null;break;case"tableau":a=c.freeTableaus().length;return b.Card.createProxyStack.call(this);case"reserve":f=instance(this.stack);f.cards=[this];this.proxyStack=f;break}return this.proxyStack},moveTo:function(g){var k=this.stack.cards,h=k.indexOf(this),j,f;b.Card.moveTo.call(this,g);k.splice(h,0,null);for(j=h+1,f=k.length;j<f;j++){k[j].pushPosition()}k.splice(h,1)},validTarget:function(f){var g=f.last();switch(f.field){case"tableau":if(!g){return a>0}else{return g.rank===this.rank+1}break;case"foundation":if(!g){return this.rank===1}else{return g.suit===this.suit&&g.rank===this.rank-1}break;default:return false;break}},isFree:function(){if(this.stack.field==="reserve"){return true}else{return b.Card.isFree.call(this)}}})},true);d.Array.each(e.fields,function(f){e[f].Stack=instance(e.Stack)},true);d.mix(e.Stack,{images:{foundation:"freeslot.png",tableau:"freeslot.png"},validTarget:function(f){return f.field==="tableau"&&this.first().validTarget(f)},validCard:function(){return a-->0}},true);d.mix(e.Tableau.Stack,{setCardPosition:function(f){var g=this.cards.last(),i=g?g.top+f.rankHeight:this.top,h=this.left;f.left=h;f.top=i}},true);d.mix(e.Reserve.Stack,{setCardPosition:function(f){var g=this.cards.last(),i=g?g.left+f.width*0.4:this.left,h=this.top;f.left=i;f.top=h}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("forty-thieves",function(c){var a=c.Solitaire,b=c.Solitaire.FortyThieves=instance(a,{fields:["Foundation","Deck","Waste","Tableau"],deal:function(){var f,d,h,e=this.deck,g=this.tableau.stacks;for(h=0;h<4;h++){for(d=0;d<10;d++){f=e.pop();g[d].push(f);f.faceUp()}}a.Util.flipStacks(f);e.createStack()},redeal:a.noop,turnOver:function(){var d=this.deck.stacks[0],f=this.waste.stacks[0],e;e=d.last();if(e){this.withoutFlip(function(){e.moveTo(f);e.faceUp();e.after(function(){a.Animation.flip(e)})})}},Stack:instance(a.Stack),Foundation:{stackConfig:{total:8,layout:{hspacing:1.25,top:0,left:function(){return a.Card.width*2.5}}},field:"foundation"},Deck:instance(a.Deck,{count:2,stackConfig:{total:1,layout:{hspacing:0,top:0,left:0}},field:"deck"}),Waste:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return a.Card.width*1.25}}},field:"waste"},Tableau:{stackConfig:{total:10,layout:{hspacing:1.25,top:function(){return a.Card.height*1.5},left:0}},field:"tableau"},Card:instance(a.Card,{origin:{left:function(){return a.game.deck.stacks[0].left},top:function(){return a.game.deck.stacks[0].top}},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return true}else{return !e.isFaceDown&&e.suit===this.suit&&e.rank===this.rank+1}break;case"foundation":if(!e){return this.rank===1}else{return e.suit===this.suit&&e.rank===this.rank-1}break;default:return false}}})});c.Array.each(b.fields,function(d){b[d].Stack=instance(b.Stack)});c.mix(b.Stack,{validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)},validCard:function(){return false}},true);c.mix(b.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true);c.mix(b.Deck.Stack,{images:{deck:null}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("freecell",function(c){var b=c.Solitaire,a=c.Solitaire.Freecell=instance(b,{fields:["Foundation","Reserve","Tableau"],deal:function(){var f,d=0,g=this.tableau.stacks,e=b.Animation.interval*50;while(f=this.deck.pop()){g[d].push(f);f.faceUp();f.flipPostMove(e);d++;if(d===g.length){d=0}}},openSlots:function(g){var j=1,e=0,h,d,k=this.reserve.stacks,f=this.tableau.stacks;for(h=0;h<k.length;h++){d=k[h];!d.last()&&j++}for(h=0;h<f.length;h++){d=f[h];g!==d&&!f[h].last()&&e++}j*=Math.pow(2,e);return j},Stack:instance(b.Stack),height:function(){return this.Card.base.height*5},Foundation:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*6}}},field:"foundation",draggable:false},Reserve:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:0}},field:"reserve",draggable:true},Tableau:{stackConfig:{total:8,layout:{hspacing:1.25,top:function(){return b.Card.height*1.5},left:0}},field:"tableau",draggable:true},Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"reserve":return true;case"tableau":return this.createProxyStack();case"foundation":return false}},createProxyStack:function(){var d=b.Card.createProxyStack.call(this);this.proxyStack=d&&d.cards.length<=b.game.openSlots(d)?d:null;return this.proxyStack},validTableauTarget:function(d){return d.color!==this.color&&d.rank===this.rank+1},validTarget:function(e){var d,f;if(e.field){d=e;f=d.last()}else{f=e;d=f.stack}switch(d.field){case"tableau":if(!f){return true}else{return this.validTableauTarget(f)}break;case"foundation":if(!f){return this.rank===1}else{return f.suit===this.suit&&f.rank===this.rank-1}break;case"reserve":return !f;break}}})});c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)},true);c.mix(a.Stack,{validTarget:function(d){if(d.field!=="tableau"||!this.first().validTarget(d)){return false}return this.cards.length<=b.game.openSlots(d,this.last())}},true);c.mix(a.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("grandfathers-clock",function(e){function b(h,g){var f=h.length;g%=f;if(g<0){g+=f}return h[g]}function d(f,h,g){if(f<=h){return f<=g&&g<=h}else{return f<=g||g<=h}}e.namespace("Solitaire.GClock");var c=e.Solitaire,a=e.Solitaire.GClock=instance(c,{fields:["Foundation","Tableau"],deal:function(){var k,p=this.deck,g=p.cards,j=[],r=["d","c","h","s"],s,o=0,n=51,l,f=this.foundation.stacks,h=this.tableau.stacks,q;while(n>=0){k=g[n];s=false;for(l=2;l<=13;l++){if(k.rank===l&&k.suit===b(r,l)){s=true;g.splice(n,1);j[l-2]=k;break}}if(!s){h[o].push(k);o=(o+1)%8;k.faceUp();q=k}n--}for(n=0;n<12;n++){f[(n+2)%12].push(j[n]);j[n].faceUp();j[n].flipPostMove(c.Animation.interval)}c.Util.flipStacks(q)},height:function(){return this.Card.base.height*5.75},maxStackHeight:function(){return this.Card.height*3},Stack:instance(c.Stack),Foundation:{stackConfig:{total:12,layout:{hspacing:1.25,top:function(){return c.Card.height*3},left:function(){return c.Card.width*3.25}}},field:"foundation",draggable:false},Tableau:{stackConfig:{total:8,layout:{hspacing:1.25,top:0,left:function(){return c.Card.width*7.25}}},field:"tableau",draggable:true},Card:instance(c.Card,{origin:{left:function(){return c.game.foundation.stacks[9].left},top:function(){return c.game.foundation.stacks[0].top}},createProxyStack:function(){var f;switch(this.stack.field){case"foundation":this.proxyStack=null;break;case"tableau":return c.Card.createProxyStack.call(this)}return this.proxyStack},validTarget:function(f){var h=f.last(),i,g;switch(f.field){case"tableau":if(!h){return true}else{return h.rank===this.rank+1}break;case"foundation":g=(f.index()+3)%12;i=h.rank;return h.suit===this.suit&&(h.rank+1)%13===this.rank%13&&d(f.first().rank,g,this.rank);break;default:return false;break}}})});e.Array.each(a.fields,function(f){a[f].Stack=instance(a.Stack)},true);e.mix(a.Stack,{validTarget:function(f){return f.field==="tableau"&&this.first().validTarget(f)},validCard:function(){return false}},true);e.mix(a.Tableau.Stack,{setCardPosition:function(f){var g=this.cards.last(),i=g?g.top+g.rankHeight:this.top,h=this.left;f.left=h;f.top=i},layout:function(g,f){c.Stack.layout.call(this,g,f);if(f>3){this.top=normalize(g.top)+c.Card.height*3.75;this.left-=c.Card.width*5}}},true);e.mix(a.Foundation.Stack,{index:function(){return a.foundation.stacks.indexOf(this)},layout:function(g,f){var j=Math.sin(Math.PI*f/6)*c.Card.height*2.25,h=Math.cos(Math.PI*f/6)*c.Card.width*3;this.top=j+normalize(g.top);this.left=h+normalize(g.left)}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("monte-carlo",function(c){var b=c.Solitaire,a=c.Solitaire.MonteCarlo=instance(b,{fields:["Foundation","Deck","Tableau"],createEvents:function(){b.createEvents.call(this);c.delegate("click",b.Events.clickEmptyDeck,b.selector,".stack");c.on("solitaire|endTurn",this.deckPlayable);c.on("solitaire|afterSetup",this.deckPlayable)},deckPlayable:function(){var e=false,d=Game.deck.stacks[0].node;Game.eachStack(function(f){if(!e&&c.Array.indexOf(f.cards,null)!==-1){e=true}},"tableau");if(e){d.addClass("playable")}else{d.removeClass("playable")}},deal:function(){var f,d,g,e=this.deck,h=this.tableau.stacks;for(d=0;d<5;d++){for(g=0;g<5;g++){f=e.pop();h[d].push(f);f.faceUp()}}f.after(function(){var s=2,r=2,u=1,o=0,t=1,q=-1,n=-1,p=1,k=0,l=50,i=70,j;for(g=0;g<25;g++){if(g===(n+1)*p){n++;p++}j=h[r].cards[s];setTimeout(function(v){b.Animation.flip(v)}.partial(j),l);l+=i;s+=u;r+=o;if(k++===n){k=0;if(u===1){t=-1}else{if(u===-1){t=1}}if(o===1){q=-1}else{if(o===-1){q=1}}u+=t;o+=q}}});e.createStack()},redeal:function(){var j=this.tableau.stacks,e=this.deck.stacks[0],k=c.Array.reduce(j,[],function(l,i){return l.concat(i.compact())}),d=k.length,f,h,g;c.Array.each(j,function(i){i.node.remove();i.cards=[];i.createNode()});for(g=h=0;g<d;g++){if(g&&!(g%5)){h++}j[h].push(k[g])}this.withoutFlip(function(){while(g<25&&e.cards.length){if(!(g%5)){h++}f=e.last();f.moveTo(j[h]);f.faceUp();f.node.setStyle("zIndex",100-g);g++;f.flipPostMove(b.Animation.interval*5)}})},height:function(){return this.Card.base.height*6},Stack:instance(b.Stack,{images:{deck:"freeslot.png"},updateDragGroups:function(){var d=b.activeCard;c.Array.each(this.cards,function(e){if(!e){return}if(d.validTarget(e)){e.node.drop.addToGroup("open")}else{e.node.drop.removeFromGroup("open")}})},index:function(){return 0}}),Events:instance(b.Events,{drop:function(h){var g=b.activeCard,d=b.game.foundation.stacks[0],f=h.drop.get("node").getData("target");if(!g){return}b.stationary(function(){f.moveTo(d);g.moveTo(d)});b.endTurn()}}),Foundation:{stackConfig:{total:1,layout:{spacing:0,top:0,left:function(){return b.Card.width*10.5}}},field:"foundation"},Deck:instance(b.Deck,{stackConfig:{total:1,layout:{spacing:0,top:0,left:function(){return b.Card.width*2}}},field:"deck",createStack:function(){var e,d;for(e=0,d=this.cards.length;e<d;e++){this.stacks[0].push(this.cards[e])}}}),Tableau:{stackConfig:{total:5,layout:{cardGap:1.25,vspacing:1.25,hspacing:0,top:0,left:function(){return b.Card.width*3.5}}},field:"tableau"},Card:instance(b.Card,{row:function(){return this.stack.index()},column:function(){return this.stack.cards.indexOf(this)},validTarget:function(d){if(this===d||!(this.rank===d.rank&&d.isFree())){return false}return Math.abs(d.row()-this.row())<=1&&Math.abs(d.column()-this.column())<=1},createProxyStack:function(){var d=null;if(this.isFree()){d=instance(this.stack);d.cards=this.proxyCards()}this.proxyStack=d;return this.proxyStack},proxyCards:function(){return[this]},isFree:function(){return this.stack.field==="tableau"},turnOver:function(){this.stack.field==="deck"&&b.game.redeal()}})});c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)});c.mix(a.Tableau.Stack,{deleteItem:function(d){var f=this.cards,e=f.indexOf(d);if(e!==-1){f[e]=null}},setCardPosition:function(d){var f=this.cards.last(),e=a.Tableau.stackConfig.layout,h=this.top,g=f?f.left+d.width*e.cardGap:this.left;d.left=g;d.top=h},compact:function(){var h=this.cards,e,g=[],f,d;for(f=0,d=h.length;f<d;f++){e=h[f];if(e){g.push(e);e.pushPosition()}}return g},index:function(){return b.game.tableau.stacks.indexOf(this)}},true);c.mix(a.Deck.Stack,{updateDragGroups:function(){var e=b.activeCard,d=this.last();if(!d){return}if(e.validTarget(d)){d.node.drop.addToGroup("open")}else{d.node.drop.removeFromGroup("open")}}},true)},"0.0.1",{requires:["solitaire","array-extras"]});YUI.add("pyramid",function(c){var a=c.Solitaire,b=c.Solitaire.Pyramid=instance(a,{fields:["Foundation","Deck","Waste","Tableau"],width:function(){return a.Card.base.width*10},deal:function(){var f,d,g,e=this.deck,h=this.tableau.stacks;for(d=0;d<7;d++){for(g=0;g<=d;g++){f=e.pop();h[d].push(f);f.faceUp()}}f.after(function(){var j=Math.floor(h.length/2),n=h.length,o,r,s,k,p=0,q=0,l=200;o=r=j;while(o>=0){s=n-1;k=[];do{k=c.Array.unique(k.concat(h[s].cards[o],h[s].cards[r]));s--;r--}while(r>=o);c.Array.each(k,function(i){setTimeout(function(){a.Animation.flip(i)},q)});p++;o=j-p;r=j+p;q+=l}setTimeout(function(){a.Animation.flip(e.last())},q)});e.createStack();f=e.last();f.faceUp()},turnOver:function(){var d=this.deck.stacks[0],e=this.waste.stacks[0];if(d.cards.length===1){return}d.last().moveTo(e)},height:function(){return this.Card.base.height*4.85},Stack:instance(a.Stack,{images:{},updateDragGroups:function(){var d=a.activeCard;c.Array.each(this.cards,function(e){if(!e){return}if(d.validTarget(e)){e.node.drop.addToGroup("open")}else{e.node.drop.removeFromGroup("open")}})}}),Events:instance(a.Events,{dragCheck:function(d){if(!a.game.autoPlay.call(this)){a.Events.dragCheck.call(this)}},drop:function(h){var g=a.activeCard,d=a.game.foundation.stacks[0],f=h.drop.get("node").getData("target");if(!g){return}a.stationary(function(){f.moveTo(d);g.moveTo(d)});a.endTurn()}}),Foundation:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return a.Card.width*8}}},field:"foundation"},Deck:instance(a.Deck,{stackConfig:{total:1,layout:{hspacing:0,top:0,left:0}},field:"deck",createStack:function(){var e,d;for(e=0,d=this.cards.length;e<d;e++){this.stacks[0].push(this.cards[e])}}}),Waste:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return a.Card.width*1.5}}},field:"waste"},Tableau:{stackConfig:{total:7,layout:{vspacing:0.6,hspacing:-0.625,cardGap:1.25,top:0,left:function(){return a.Card.width*5}}},field:"tableau"},Card:instance(a.Card,{validTarget:function(d){if(d.field==="foundation"){return this.isFree()&&this.rank===13}if(d.isFree()){return this.rank+d.rank===13}return false},createProxyNode:function(){return this.rank===13?"":a.Card.createProxyNode.call(this)},createProxyStack:function(){var d=null;if(this.isFree()){d=instance(this.stack);d.cards=this.proxyCards()}this.proxyStack=d;return this.proxyStack},proxyCards:function(){return[this]},isFree:function(){var d=this.stack,h=d.index(),f=d.cards.indexOf(this),e=a.game,g=d.next();if(d.field==="deck"||d.field==="waste"){return !this.isFaceDown&&this===this.stack.last()}else{return !(this.stack.field==="foundation"||g&&(g.cards[f]||g.cards[f+1]))}},turnOver:function(){this.stack.field==="deck"&&!this.isFaceDown&&a.game.turnOver()}})});c.Array.each(b.fields,function(d){b[d].Stack=instance(b.Stack)});c.mix(b.Tableau.Stack,{deleteItem:function(d){var f=this.cards,e=f.indexOf(d);if(e!==-1){f[e]=null}},setCardPosition:function(d){var f=b.Tableau.stackConfig.layout,e=this.cards.last(),h=this.top,g=e?e.left+d.width*f.cardGap:this.left;d.left=g;d.top=h;d.zIndex=this.index()*10}},true);c.mix(b.Deck.Stack,{deleteItem:function(d){b.Stack.deleteItem.call(this,d);this.update()},update:function(d){var e=this.last();e&&e.faceUp(d)},updateDragGroups:function(){var e=a.activeCard,d=this.last();if(!d){return}if(e.validTarget(d)){d.node.drop.addToGroup("open")}else{d.node.drop.removeFromGroup("open")}}},true);b.Waste.Stack.updateDragGroups=b.Deck.Stack.updateDragGroups},"0.0.1",{requires:["solitaire"]});YUI.add("russian-solitaire",function(d){var b=d.Solitaire,c=b.Yukon,a=b.RussianSolitaire=instance(c,{Card:instance(c.Card)});a.Card.validTarget=function(e){var f=e.last();switch(e.field){case"tableau":if(!f){return this.rank===13}else{return !f.isFaceDown&&f.suit===this.suit&&f.rank===this.rank+1}case"foundation":if(!f){return this.rank===1}else{return f.suit===this.suit&&f.rank===this.rank-1}default:return false}}},"0.0.1",{requires:["yukon"]});YUI.add("scorpion",function(c){var b=c.Solitaire,a=b.Scorpion=instance(b,{fields:["Foundation","Deck","Tableau"],createEvents:function(){b.AutoStackClear.register();b.createEvents.call(this)},deal:function(){var f,d,h,e=this.deck,g=this.tableau.stacks;for(h=0;h<7;h++){for(d=0;d<7;d++){f=e.pop();g[d].push(f);if(!(h<3&&d<4)){f.faceUp()}}}b.Util.flipStacks(f);e.createStack()},turnOver:function(){var e=this.deck.stacks[0],h=this.tableau.stacks,f,g,d;this.withoutFlip(function(){for(g=0;g<3;g++){f=e.last().faceUp();f.flipPostMove(0);f.moveTo(h[g])}});setTimeout(function(){Game.eachStack(function(i){c.fire("tableau:afterPush",i);Game.endTurn()},"tableau")},0)},height:function(){return this.Card.base.height*5.6},Stack:instance(b.Stack),Deck:instance(b.Deck,{stackConfig:{total:1,layout:{top:0,left:function(){return b.Card.width*9}}},field:"deck",createStack:function(){var e,d;for(e=this.cards.length-1;e>=0;e--){this.stacks[0].push(this.cards[e])}}}),Foundation:{stackConfig:{total:4,layout:{top:function(){return b.Card.height*1.1},left:function(){return b.Card.width*9},vspacing:1.1}},field:"foundation"},Tableau:{stackConfig:{total:7,layout:{hspacing:1.25,top:0,left:0}},field:"tableau"},Card:instance(b.Card,{playable:function(){var d=this.stack.field;return d==="deck"||d==="tableau"&&!this.isFaceDown},validTarget:function(d){var e=d.last();if(d.field!=="tableau"){return false}if(!e){return this.rank===13}else{return !e.isFaceDown&&e.suit===this.suit&&e.rank===this.rank+1}}})});c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)});c.mix(a.Stack,{validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)},validProxy:function(d){return true},validTarget:function(d){var g,f=this.cards,e;switch(d.field){case"tableau":return this.first().validTarget(d);break;case"foundation":g=this.last.rank;if(f.length!==13){return false}for(e=0;e<13;e++){if(f[e].rank!==g){return false}}return true;break}}},true);c.mix(a.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true)},"0.0.1",{requires:["auto-stack-clear","util"]});YUI.add("spider",function(e){var a=0,b=e.Solitaire,d=b.Util,c=b.Spider=instance(b,{fields:["Foundation","Deck","Tableau"],createEvents:function(){b.AutoStackClear.register();b.createEvents.call(this)},deal:function(){var f=0,g=this.deck,j=this.tableau.stacks,i,l,k=b.Animation,h=k.interval*j.length*4;for(l=0;l<5;l++){for(f=0;f<10;f++){if(f<4||l<4){j[f].push(g.pop())}}}for(f=0;f<10;f++){i=g.pop();i.flipPostMove(h);j[f].push(i);i.faceUp()}g.createStack()},redeal:b.noop,turnOver:function(){var g=this.deck.stacks[0],j=b.Animation,h,f;if(d.hasFreeTableaus()){return}this.withoutFlip(function(){this.eachStack(function(i){var k=g.last();if(k){k.faceUp().moveTo(i).after(function(){this.stack.updateCardsPosition();j.flip(this)})}},"tableau")});setTimeout(function(){Game.eachStack(function(i){e.fire("tableau:afterPush",i);Game.endTurn()},"tableau")},0)},Stack:instance(b.Stack),Foundation:{stackConfig:{total:8,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*2.5}}},field:"foundation",draggable:false},Deck:instance(b.Deck,{count:2,stackConfig:{total:1,layout:{hspacing:0,top:0,left:0}},field:"deck"}),Tableau:{stackConfig:{total:10,layout:{hspacing:1.25,top:function(){return b.Card.height*1.5},left:0}},field:"tableau"},Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"tableau":return this.createProxyStack();case"deck":return !d.hasFreeTableaus();case"foundation":return false}},createProxyStack:function(){a=d.freeTableaus().length;return b.Card.createProxyStack.call(this)},validTarget:function(f){if(f.field!=="tableau"){return false}var g=f.last();return !g?a>0:!g.isFaceDown&&g.rank===this.rank+1}})});e.Array.each(c.fields,function(f){c[f].Stack=instance(c.Stack)});e.mix(c.Stack,{validCard:function(f){if(f.suit===this.cards.last().suit){return true}else{return a-->0}},validTarget:function(f){switch(f.field){case"tableau":return this.first().validTarget(f);break;case"foundation":return this.cards.length===13;break}}},true);e.mix(c.Deck.Stack,{setCardPosition:function(f){var h=this.cards.length,g=b.game.tableau.stacks.length;f.top=this.top;f.left=this.left+Math.floor(h/g)*f.width*0.2}},true);e.mix(c.Tableau.Stack,{setCardPosition:function(f){var g=this.cards.last(),i=g?g.top+g.rankHeight:this.top,h=this.left;f.left=h;f.top=i}},true)},"0.0.1",{requires:["auto-stack-clear","util"]});YUI.add("spider1s",function(b){var a=b.Solitaire.Spider1S=instance(b.Solitaire.Spider);a.Deck=instance(b.Solitaire.Spider.Deck,{suits:["s"],count:8})},"0.0.1",{requires:["spider"]});YUI.add("spider2s",function(b){var a=b.Solitaire.Spider2S=instance(b.Solitaire.Spider);a.Deck=instance(b.Solitaire.Spider.Deck,{suits:["s","h"],count:4})},"0.0.1",{requires:["spider"]});YUI.add("spiderette",function(e){var b=e.Solitaire,a=b.Klondike,d=b.Spider,c=e.Solitaire.Spiderette=instance(d,{height:a.height,deal:a.deal,Tableau:instance(d.Tableau,{stackConfig:a.Tableau.stackConfig}),Foundation:instance(d.Foundation,{stackConfig:a.Foundation.stackConfig}),Deck:instance(d.Deck,{count:1})})},"0.0.1",{requires:["klondike","spider"]});YUI.add("tri-towers",function(b){var a=b.Solitaire,c=b.Solitaire.TriTowers=instance(a,{fields:["Deck","Foundation","Tableau"],width:function(){return this.Card.base.width*15},height:function(){return this.Card.base.height*5},createEvents:function(){b.on("solitaire|endTurn",function(){var d=a.game.tableau.stacks,e;for(e=0;e<3;e++){b.fire("tableau:afterPop",d[e])}});a.createEvents.call(this)},deal:function(){var g,d,j=this.tableau.stacks,e=this.deck,f=this.foundation.stacks[0],h,k;for(d=0;d<4;d++){k=(d+1)*3;for(h=0;h<k;h++){g=e.pop();j[d].push(g);if(d===3){g.faceUp()}}}g.after(function(){a.Animation.flip(f.last());j[3].eachCard(function(i){a.Animation.flip(i)})});g=e.pop();f.push(g);g.faceUp();e.createStack()},turnOver:function(){var d=this.deck.stacks[0],e=this.foundation.stacks[0],f=d.last();f&&f.faceUp().moveTo(e)},isWon:function(){var d=true;this.eachStack(function(e){e.eachCard(function(f){if(f){d=false}return d})},"tableau");return d},Deck:instance(a.Deck,{field:"deck",stackConfig:{total:1,layout:{hspacing:0,top:function(){return a.Card.height*4},left:0}},createStack:function(){var e,d;for(e=0,d=this.cards.length;e<d;e++){this.stacks[0].push(this.cards[e])}}}),Tableau:{field:"tableau",stackConfig:{total:4,layout:{rowGaps:[3.75,2.5,1.25,0],cardGap:1.25,vspacing:0.6,hspacing:-0.625,top:0,left:function(){return a.Card.width*1.875}}}},Foundation:{field:"foundation",stackConfig:{total:1,layout:{hspacing:0,top:function(){return a.Card.height*4},left:function(){return a.Card.width*4}}}},Events:instance(a.Events,{dragCheck:function(d){this.getCard().autoPlay();this._afterDragEnd();d.halt()}}),Card:instance(a.Card,{validTarget:function(d){if(d.field!=="foundation"){return false}var e=d.last(),f=Math.abs(this.rank-e.rank);return f===1||f===12},playable:function(){var d=this.stack;switch(d.field){case"deck":return this===d.last();case"tableau":return this.autoPlay(true);default:return false}},isFree:function(){var d=this.stack,g=d.next(),h=this.tower(),e=d.cards.indexOf(this),f;if(d.field!=="tableau"){return false}if(!g){return true}for(f=0;f<2;f++){if(g.cards[e+h+f]){return false}}return true},tower:function(){var d=this.stack,e=d.cards.indexOf(this),f=d.index()+1;return Math.floor(e/f)}}),Stack:instance(a.Stack,{images:{}})},true);b.Array.each(c.fields,function(d){c[d].Stack=instance(c.Stack)});b.mix(c.Tableau.Stack,{deleteItem:function(d){var f=this.cards,e=f.indexOf(d);if(e!==-1){f[e]=null}},setCardPosition:function(f){var l=this.last(),j=this.top,e,i,k,h=c.Tableau.stackConfig.layout,d=h.rowGaps,g=h.cardGap;if(l){e=l.left+f.width*g;i=this.cards.length;k=this.index()+1;if(!(i%k)){e+=d[k-1]*f.width}}else{e=this.left}f.top=j;f.left=e;f.zIndex=this.index()*10}},true);b.mix(c.Deck.Stack,{setCardPosition:function(d){var e=this.last(),g,f,h;g=this.top;if(e){f=e.left+d.width*0.1;h=e.zIndex+1}else{f=this.left;h=0}d.top=g;d.left=f;d.zIndex=h}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("will-o-the-wisp",function(c){var b=c.Solitaire,a=c.Solitaire.WillOTheWisp=instance(b.Spiderette,{deal:function(){var d=this.deck,e;for(e=0;e<3;e++){this.eachStack(function(f){var g=d.pop();f.push(g);if(e===2){g.faceUp();g.flipPostMove()}},"tableau")}d.createStack()}})},"0.0.1",{requires:["spiderette"]});YUI.add("yukon",function(c){var a=c.Solitaire,b=a.Yukon=instance(a,{fields:["Foundation","Tableau"],deal:function(){var h,e=6,d=0,f=this.deck,i=this.tableau.stacks,g=a.Animation.interval*50;while(e>=0){h=f.pop();i[6-e].push(h);h.faceUp();h.flipPostMove(g);for(d=7-e;d<7;d++){h=f.pop();i[d].push(h)}e--}d=1;while(f.cards.length){h=f.pop();i[d].push(h);h.faceUp();h.flipPostMove(g);d=(d%6)+1}},height:function(){return this.Card.base.height*4.8},Stack:instance(a.Stack),Foundation:{stackConfig:{total:4,layout:{vspacing:1.25,top:0,left:function(){return a.Card.width*9}}},field:"foundation",draggable:false},Tableau:{stackConfig:{total:7,layout:{hspacing:1.25,top:0,left:0}},field:"tableau",draggable:true},Card:instance(a.Card,{playable:function(){return this.stack.field==="tableau"&&!this.isFaceDown},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return this.rank===13}else{return !e.isFaceDown&&e.color!==this.color&&e.rank===this.rank+1}break;case"foundation":if(!e){return this.rank===1}else{return e.suit===this.suit&&e.rank===this.rank-1}break;default:return false}}})});c.Array.each(b.fields,function(d){b[d].Stack=instance(b.Stack)});c.mix(b.Stack,{validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)},validProxy:function(d){return true}},true);c.mix(b.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("simple-simon",function(c){var b=c.Solitaire,a=b.SimpleSimon=instance(b.Spider,{fields:["Foundation","Tableau"],deal:function(){var f,d=0,g=this.tableau.stacks,h=g.length,e=b.Animation.interval*10;while(f=this.deck.pop()){g[d].push(f);f.faceUp();f.flipPostMove(e);d++;if(d===h){d=0;h--}}},turnOver:b.noop,Deck:instance(b.Deck),Foundation:instance(b.Spider.Foundation),Card:instance(b.Spider.Card,{origin:{left:function(){return b.Card.width*6},top:function(){return b.container().get("winHeight")-b.Card.height*1.25}}})});a.Foundation.stackConfig={total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*3.75}}}},"0.0.1",{requires:["spider"]});YUI.add("bakersdozen",function(c){var a=c.Solitaire,b=c.Solitaire.BakersDozen=instance(a,{fields:["Foundation","Tableau"],deal:function(){var g,l,d,k=0,e=this.tableau.stacks,j=200,f=150,n=this,h;for(k=0;k<13;k++){for(h=0;h<4;h++){g=this.deck.pop();e[k].push(g);g.faceUp()}d=e[k].cards;for(h=1;h<4;h++){if(d[h].rank===13){g=d.splice(h,1)[0];d.unshift(g)}}}l=e[e.length-1].last();a.Util.flipStacks(l)},height:function(){return this.Card.base.height*5},maxStackHeight:function(){return a.Card.height*2.5},Stack:instance(a.Stack),Foundation:{stackConfig:{total:4,layout:{vspacing:1.25,top:0,left:function(){return a.Card.width*10.5}}},field:"foundation"},Tableau:{stackConfig:{total:13,layout:{hspacing:1.25,top:0,left:0}},field:"tableau"},Card:instance(a.Card,{playable:function(){return this.stack.field==="tableau"&&this===this.stack.last()},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return false}else{return e.rank===this.rank+1}break;case"foundation":if(!e){return this.rank===1}else{return e.suit===this.suit&&e.rank===this.rank-1}break;default:return false}}})});c.Array.each(b.fields,function(d){b[d].Stack=instance(b.Stack)});c.mix(b.Stack,{validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)},validCard:function(){return false}},true);c.mix(b.Tableau.Stack,{images:{},setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g},layout:function(e,d){a.Stack.layout.call(this,e,d);if(d>6){this.top+=a.Card.height*2.75;this.left-=a.Card.width*8.1}}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("eightoff",function(c){var b=c.Solitaire,a=c.Solitaire.Eightoff=instance(b,{fields:["Foundation","Reserve","Tableau"],deal:function(){var f,d,h=this.tableau.stacks,e=this.reserve.stacks,g;for(g=0,d=0;g<48;g++){f=this.deck.pop();h[d].push(f);f.faceUp();f.flipPostMove(0);d++;if(d===8){d=0}}for(g=0,d=0;g<4;g++){f=this.deck.pop();e[d].push(f);f.faceUp();f.flipPostMove(0);d++}},openSlots:function(d){var f=1,e,g=this.reserve.stacks;for(e=0;e<g.length;e++){if(!g[e].last()){f++}}return f},Stack:instance(b.Stack),height:function(){return this.Card.base.height*5},Foundation:{stackConfig:{total:4,layout:{vspacing:1.25,top:0,left:function(){return b.Card.width*10.5}}},field:"foundation",draggable:false},Reserve:{stackConfig:{total:8,layout:{hspacing:1.25,top:0,left:0}},field:"reserve",draggable:true},Tableau:{stackConfig:{total:8,layout:{hspacing:1.25,top:function(){return b.Card.height*1.25},left:0}},field:"tableau",draggable:true},Card:instance(b.Card,{origin:{left:function(){return b.Card.width*5},top:function(){return b.container().get("winHeight")-b.Card.height*1.2}},playable:function(){switch(this.stack.field){case"reserve":return true;case"tableau":return this.createProxyStack();case"foundation":return false}},createProxyStack:function(){var d=b.Card.createProxyStack.call(this);this.proxyStack=d&&d.cards.length<=a.openSlots(d)?d:null;return this.proxyStack},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return this.rank===13}else{return e.suit===this.suit&&e.rank===this.rank+1}break;case"foundation":if(!e){return this.rank===1}else{return e.suit===this.suit&&e.rank===this.rank-1}break;case"reserve":return !e;break}}})});c.Array.each(a.fields,function(d){a[d].Stack=instance(a.Stack)},true);c.mix(a.Stack,{validTarget:function(d){if(d.field!=="tableau"||!this.first().validTarget(d)){return false}return this.cards.length<=a.openSlots(d,this.last())}},true);c.mix(a.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("acesup",function(c){var b=c.Solitaire,d=c.Solitaire.AcesUp=instance(b,{fields:["Foundation","Deck","Tableau"],deal:function(){var g,e,f=this.deck,i=this.tableau.stacks,h=[];for(e=0;e<i.length;e++){g=f.pop();h.push(g);if(e===i.length-1){g.after(function(){c.Array.forEach(h,function(j){b.Animation.flip(j)})})}i[e].push(g);g.faceUp()}f.createStack()},turnOver:function(){var e,i=this.tableau.stacks,f=this.deck.stacks[0],g,h=[];this.withoutFlip(function(){for(e=0;e<i.length;e++){if(!f.last()){break}g=f.last();g.moveTo(i[e]);g.faceUp();h.push(g)}});g.after(function(){c.Array.forEach(h,function(j){b.Animation.flip(j)})})},isWon:function(){return this.foundation.stacks[0].cards.length===48},height:function(){return this.Card.base.height*3},Stack:instance(b.Stack),Foundation:{stackConfig:{total:1,layout:{spacing:0,top:0,left:function(){return b.Card.width*7}}},field:"foundation"},Deck:instance(b.Deck,{stackConfig:{total:1,layout:{spacing:0,top:0,left:0}},field:"deck"}),Tableau:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*1.6}}},field:"tableau"},Events:instance(b.Events,{dragCheck:function(f){if(!b.game.autoPlay.call(this)){b.Events.dragCheck.call(this)}}}),Card:instance(b.Card,{validTarget:function(e){if(e.field==="tableau"){return !e.last()}if(e.field!=="foundation"||this.rank===1){return false}var f=false;Game.eachStack(function(g){if(f){return}var h=g.last();if(h&&h.suit===this.suit&&(h.rank>this.rank||h.rank===1)){f=true}}.bind(this),"tableau");return f},playable:function(){return this.stack.field==="deck"||(this.isFree()&&(this.validTarget(Game.foundation.stacks[0])||a()))}})});function a(){return c.Array.some(Game.tableau.stacks,function(e){return !e.cards.length})}c.Array.each(d.fields,function(e){d[e].Stack=instance(d.Stack)});c.mix(d.Deck.Stack,{images:{}},true);c.mix(d.Tableau.Stack,{setCardPosition:function(e){var f=this.cards.last(),h=f?f.top+f.rankHeight:this.top,g=this.left,i=f?f.zIndex+1:1;e.zIndex=i;e.left=g;e.top=h}},true)},"0.0.1",{requires:["solitaire","array-extras"]});YUI.add("alternations",function(c){var a=c.Solitaire,b=a.Alternations=instance(a,{fields:["Deck","Foundation","Tableau","Waste"],deal:function(){var e=this.deck,h=this.tableau.stacks,d=0,j=0,f,g;for(g=0;g<h.length*7;g++){f=e.pop();h[d++].push(f);if(!(j%2)){f.faceUp()}if(!((g+1)%7)){d=0;j++}}f.after(function(){var s=7,n=h.length,p=n+Math.floor(s/2),q=0,r,l,i,o=0,k=200;for(q=0;q<p;q++){i=[];l=q;r=0;while(r<s&&l>=0){d=h[l];if(d&&d.cards[r]){i.push(d.cards[r])}r+=2;l--}c.Array.each(i,function(t){setTimeout(function(){a.Animation.flip(t)},o)});o+=k}});e.createStack()},turnOver:function(){var d=this.deck.stacks[0],f=this.waste.stacks[0],e;this.withoutFlip(function(){e=d.last();if(e){e.flipPostMove(0);e.faceUp().moveTo(f)}})},Deck:instance(a.Deck,{count:2,stackConfig:{total:1,layout:{top:function(){return c.Solitaire.Card.height*1.5},left:0}},field:"deck"}),Waste:{stackConfig:{total:1,layout:{top:function(){return c.Solitaire.Card.height*2.75},left:0}},field:"waste"},Tableau:{stackConfig:{total:7,layout:{hspacing:1.25,top:function(){return c.Solitaire.Card.height*1.5},left:function(){return c.Solitaire.Card.width*2.3}}},field:"tableau"},Foundation:{stackConfig:{total:8,layout:{hspacing:1.4,top:0,left:0}},field:"foundation"},Card:instance(a.Card,{playable:function(){switch(this.stack.field){case"deck":case"waste":return true;case"tableau":return this.createProxyStack();case"foundation":return false}},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return true}else{return !e.isFaceDown&&e.rank===this.rank+1}case"foundation":if(!e){return this.rank===1}else{return this.suit===e.suit&&this.rank===e.rank+1}default:return false}}}),Stack:instance(a.Stack,{images:{foundation:"freeslot.png",tableau:"freeslot.png"},validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)}})});c.Array.each(b.fields,function(d){b[d].Stack=instance(b.Stack)});c.mix(b.Tableau.Stack,{setCardPosition:function(e){var d,f=this.cards.last(),h,g=this.left;if(f){d=f.isFaceDown?f.rankHeight*2:f.rankHeight;h=f.top+d}else{h=this.top}e.left=g;e.top=h}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("bakersgame",function(b){var a=b.Solitaire.BakersGame=instance(b.Solitaire.Freecell,{Card:instance(b.Solitaire.Freecell.Card,{validTableauTarget:function(c){return c.suit===this.suit&&c.rank===this.rank+1}})})},"1.0.0",{requires:["freecell"]});YUI.add("baroness",function(c){var a=c.Solitaire,d=a.AcesUp,b=a.Baroness=instance(d,{createEvents:function(){a.createEvents.call(this);c.on("solitaire|endTurn",this.fillTableau.bind(this))},turnOver:function(){if(c.Array.every(this.tableau.stacks,function(e){return e.last()})){d.turnOver.call(this)}},fillTableau:function(){var h=this.tableau.stacks,e=this.deck.stacks[0],j,g,i=[],f=c.Array.reduce(h,0,function(l,k){return l+k.cards.length});if(f>=h.length){return}j=5-f;this.withoutFlip(function(){this.eachStack(function(k){if(!(j&&e.cards.length)){return}if(!k.last()){g=e.last();g.moveTo(k);g.faceUp();j--;i.push(g)}},"tableau")});if(g){g.after(function(){c.Array.each(i,function(k){a.Animation.flip(k)})})}},isWon:a.isWon,Events:instance(a.Pyramid.Events,{drop:function(i){var h=a.activeCard,f=a.game.foundation.stacks[0],g=i.drop.get("node").getData("target");if(!h){return}if(g.field){if(!g.last()){h.moveTo(g)}else{a.stationary(function(){g.last().moveTo(f);h.moveTo(f)})}}else{a.stationary(function(){g.moveTo(f);h.moveTo(f)})}c.fire("endTurn")}}),Tableau:instance(d.Tableau,{stackConfig:instance(d.Tableau.stackConfig,{total:5})}),Stack:instance(d.Stack,{updateDragGroups:c.Solitaire.Pyramid.Stack.updateDragGroups}),Foundation:instance(d.Foundation,{stackConfig:{total:1,layout:{spacing:0,top:0,left:function(){return c.Solitaire.Card.width*8.5}}}}),Card:instance(d.Card,{playable:function(){return this.isFree()},validTarget:function(f){var e=f.last();if(f.field==="foundation"){return this.isFree()&&this.rank===13}if(!e){return true}return !e.isFaceDown&&(this.rank+e.rank===13)}})})},"1.0.0",{requires:["acesup","pyramid"]});YUI.add("canfield",function(e){var d=e.Solitaire,b=d.Agnes,a=d.Klondike,c=d.Canfield=instance(b,{height:d.height,maxStackHeight:d.maxStackHeight,createEvents:function(){d.createEvents.call(this);e.on("solitaire|endTurn",this.fillTableau.bind(this))},fillTableau:function(){var f=this.reserve.stacks[0],g=f.last(),h;if(!g){return}h=e.Array.find(this.tableau.stacks,function(i){return !i.last()});if(h){g.moveTo(h)}g=f.last();if(g&&g.isFaceDown){g.faceUp()}},redeal:a.redeal,turnOver:a.turnOver,deal:function(){var h,g=this.deck,l=this.tableau.stacks,f=this.reserve.stacks[0],k=13,j;for(j=0;j<l.length;j++){h=g.pop();l[j].push(h);h.faceUp();h.flipPostMove(d.Animation.interval*5)}for(j=0;j<k;j++){h=g.pop();f.push(h);if(j===k-1){h.faceUp();h.flipPostMove(0)}}h=g.pop();this.foundation.stacks[0].push(h);h.faceUp();h.flipPostMove(0);g.createStack()},Tableau:instance(b.Tableau,{stackConfig:{total:4,layout:{hspacing:1.25,top:function(){return d.Card.height*1.5},left:function(){return d.Card.width*3.75}}}}),Reserve:instance(b.Reserve,{stackConfig:{total:1,layout:{left:function(){return d.Card.width*1.5},top:function(){return d.Card.height*1.5}}}}),Waste:a.Waste,Card:instance(b.Card,{validFreeTableauTarget:function(){return true}})})},"1.0.0",{requires:["agnes"]});YUI.add("doubleklondike",function(d){var c=d.Solitaire,b=c.Klondike,a=d.Solitaire.DoubleKlondike=instance(b,{Foundation:instance(b.Foundation,{stackConfig:{total:8,layout:{hspacing:1.25,top:0,left:function(){return c.Card.width*3.25}}},field:"foundation"}),Tableau:instance(b.Tableau,{stackConfig:{total:9,layout:{hspacing:1.25,top:function(){return c.Card.height*1.5},left:function(){return c.Card.width*2}}}}),Deck:instance(b.Deck,{count:2})})},"1.0.0",{requires:["freecell"]});YUI.add("thefan",function(b){var c=b.Solitaire.LaBelleLucie,a=b.Solitaire.TheFan=instance(c,{initRedeals:b.Solitaire.noop,Tableau:instance(c.Tableau,{Stack:instance(c.Tableau.Stack,{images:{tableau:"freeslot.png"}})}),Deck:instance(c.Deck,{Stack:instance(c.Deck.Stack,{images:{}})}),Card:instance(c.Card,{validTableauTarget:function(d){if(!d){return this.rank===13}return d.suit===this.suit&&d.rank===this.rank+1}})})},"1.0.0",{requires:["labellelucie"]});YUI.add("labellelucie",function(b){var a=b.Solitaire,c=b.Solitaire.LaBelleLucie=instance(a,{redeals:0,redealSeed:0,fields:["Foundation","Tableau","Deck"],initRedeals:function(){this.redeals=2;this.redealSeed=Math.random()*2147483647>>>0;this.deck.stacks[0].node.addClass("playable")},createEvents:function(){a.createEvents.call(this);b.delegate("click",a.Events.clickEmptyDeck,a.selector,".stack");b.on("solitaire|newGame",this.initRedeals.bind(this));b.on("solitaire|afterSetup",function(){if(Game.redeals){Game.deck.stacks[0].node.addClass("playable")}})},serialize:function(){var d=this.redealSeed,e=String.fromCharCode(d>>24)+String.fromCharCode((d>>16)&255)+String.fromCharCode((d>>8)&255)+String.fromCharCode(d&255);return String.fromCharCode(this.redeals)+e+a.serialize.call(this)},unserialize:function(d){this.redeals=d.charCodeAt(0);this.redealSeed=d.charCodeAt(1)<<24+d.charCodeAt(2)<<16+d.charCodeAt(3)<<8+d.charCodeAt(4);return a.unserialize.call(this,d.substr(5))},redeal:function(){if(!this.redeals){return}var d=this.deck;d.cards=[];Game.eachStack(function(e){e.eachCard(function(g){g.pushPosition()});var f=e.cards;e.cards=[];d.cards=d.cards.concat(f)},"tableau");Game.pushMove(function(){Game.redeals++});d.msSeededShuffle(this.redealSeed);this.deal(true);this.redeals--;if(!this.redeals){this.deck.stacks[0].node.removeClass("playable")}},deal:function(j){var f,e=this.deck,d,h=Game.tableau.stacks,g;for(d=0;d<18;d++){for(g=0;g<3;g++){f=e.pop();if(!f){break}h[d].push(f);if(!j){f.faceUp()}}}if(!j){a.Util.flipStacks(h[h.length-1].last());e.createStack()}},width:function(){return this.Card.base.width*12.5},height:function(){return this.Card.base.height*7},maxStackHeight:function(){return a.Card.height*2.5},Stack:instance(a.Stack,{images:{deck:"freeslot.png",foundation:"freeslot.png",tableau:null},validTarget:function(d){return d.field==="tableau"&&this.first().validTarget(d)},validCard:function(){return false}}),Foundation:{stackConfig:{total:4,layout:{hspacing:1.5,top:0,left:function(){return a.Card.width*3.5}}},field:"foundation"},Tableau:{stackConfig:{total:18,layout:{hspacing:2.5,top:function(){return a.Card.width*2},left:0}},field:"tableau"},Deck:instance(a.Deck,{stackConfig:{total:1,layout:{top:0,left:0}},field:"deck"}),Card:instance(a.Card,{playable:function(){return this.stack.field==="tableau"&&this===this.stack.last()},validTableauTarget:function(d){if(!d){return false}else{return d.suit===this.suit&&d.rank===this.rank+1}},validTarget:function(d){var e=d.last();switch(d.field){case"tableau":return this.validTableauTarget(e);case"foundation":if(!e){return this.rank===1}else{return e.suit===this.suit&&e.rank===this.rank-1}break;default:return false}}})});b.Array.each(c.fields,function(d){c[d].Stack=instance(c.Stack)});b.mix(c.Tableau.Stack,{setCardPosition:function(e){var d=e.width/4,f=this.cards.last(),h=this.top,g=f?f.left+d:this.left,i=f?f.zIndex+1:1;e.zIndex=i;e.left=g;e.top=h},layout:function(e,d){var f=Math.floor(d/5);a.Stack.layout.call(this,e,d);this.top+=a.Card.height*1.5*f;this.left-=a.Card.width*12.5*f}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("calculation",function(e){function b(h,g){var f=h.length;g%=f;if(g<0){g+=f}return h[g]}function d(f,h,g){if(f<=h){return f<=g&&g<=h}else{return f<=g||g<=h}}var c=e.Solitaire,a=e.Solitaire.Calculation=instance(c,{fields:["Foundation","Tableau","Deck","Waste"],deal:function(){var h,g=this.deck.cards,o=[],f=["s","c","d","h"],n,k,j=51,l=this.foundation.stacks;while(j>=0){h=g[j];k=false;for(n=1;n<=4;n++){if(h.rank===n&&h.suit===f[n-1]){k=true;g.splice(j,1);o.push(h);break}}j--}o.sort(function(p,i){return p.rank-i.rank});for(j=0;j<4;j++){h=o[j];l[j].push(h);h.faceUp()}h.after(function(){e.Array.each(o,function(i){c.Animation.flip(i)})});this.deck.createStack()},turnOver:function(){var g=this.deck.stacks[0].last(),f=this.waste.stacks[0];if(g&&!f.last()){this.withoutFlip(function(){g.moveTo(f);g.faceUp();g.flipPostMove(0)})}},redeal:c.noop,height:function(){return this.Card.base.height*3},Stack:instance(c.Stack,{images:{deck:null,waste:null,tableau:"freeslot.png",foundation:"freeslot.png"}}),Foundation:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return c.Card.width*3.75}}},field:"foundation"},Tableau:{stackConfig:{total:4,layout:{hspacing:1.25,top:function(){return c.Card.height*1.25},left:function(){return c.Card.width*3.75}}},field:"tableau"},Deck:instance(c.Deck,{stackConfig:{total:1,layout:{hspacing:0,top:0,left:0}},field:"deck"}),Waste:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return c.Card.width*1.25}}},field:"waste"},Card:instance(c.Card,{playable:function(){switch(this.stack.field){case"waste":return this.isFree();case"tableau":return this.isFree()&&this.autoPlay(true);case"foundation":return false;case"deck":return !c.game.waste.stacks[0].last()}},validTarget:function(f){var h=f.last(),g;switch(f.field){case"tableau":if(this.stack.field==="tableau"){return false}return true;case"foundation":g=f.index()+1;return h.rank!==13&&((this.rank%13)===(h.rank+g)%13);default:return false}}})});e.Array.each(a.fields,function(f){a[f].Stack=instance(a.Stack)},true);e.mix(a.Tableau.Stack,{setCardPosition:function(f){var g=this.cards.last(),i=g?g.top+g.rankHeight:this.top,h=this.left;f.left=h;f.top=i}},true)},"0.0.1",{requires:["solitaire"]});YUI.add("seven-toes",function(f){function e(g){var j,k,h;h=g.cards.last();k=h.rank;for(j=g.cards.length-2;j>=0;j--){h=g.cards[j];if(h.isFaceDown||h.rank==13){break}k=h.rank}return k}function c(g){var h,j;if(g.cards.length!==13){return 0}if(g.cards[0].rank!=13){return 0}if(g.cards[0].isFaceDown){return 0}j=g.cards[0].suit;for(h=1;h<13;h++){if(g.cards[h].suit!==j){return 0}}return g.cards[1].rank}var d=f.Solitaire,a=d.Klondike,b=f.Solitaire.SevenToes=instance(d,{fields:["Foundation","Tableau","Deck","Waste"],deal:function(){var g,j,h,k;g=this.deck;for(k=0;k<this.foundation.stacks.length;k++){h=this.deck.pop();j=this.foundation.stacks[k];j.push(h);h.faceUp();h.flipPostMove(d.Animation.interval*5)}g=this.deck.stacks[0];j=this.foundation.stacks[0];a.deal.call(this)},turnOver:function(){var h=this.deck.stacks[0],o=this.waste.stacks[0],p=a.Card.updatePosition,g=d.game.Card,j,n=[],l,k;g.updatePosition=d.noop;this.withoutFlip(function(){j=h.last();n.push(j);j.faceUp();j.moveTo(o);j.flipPostMove(d.Animation.interval*5)});g.updatePosition=p;o.updateCardsPosition()},redeal:d.noop,height:function(){return this.Card.base.height*5},autoPlay:function(g){return false},maxStackHeight:function(){return d.Card.height*2.4},Stack:instance(d.Stack,{images:{deck:null,waste:null,tableau:"freeslot.png",foundation:"freeslot.png"}}),Foundation:{stackConfig:{total:6,layout:{hspacing:1.25,top:0,left:function(){return d.Card.width*3.75}}},field:"foundation"},Tableau:instance(a.Tableau,{stackConfig:{total:7,layout:{hspacing:1.25,top:function(){return d.Card.height*2.5},left:function(){return d.Card.width*2.5}}}}),Deck:instance(a.Deck,{suits:["s","h","c","d","s","h"],field:"deck"}),isWon:function(){var j=0,h,g,k;for(h=0;h<this.foundation.stacks.length;h++){g=this.foundation.stacks[h];k=c(g);if(k>0){j=j|(1<<(k-1))}else{return false}}if(j===parseInt("111111",2)||j===parseInt("111111000000",2)){return true}else{return false}},Waste:{stackConfig:{total:1,layout:{hspacing:0,top:0,left:function(){return d.Card.width*1.25}}},field:"waste"},Card:instance(d.Card,{playable:function(){switch(this.stack.field){case"deck":case"waste":return this.isFree();case"tableau":case"foundation":if(this.isFaceDown){return false}else{if(this.isFree()){return true}else{return this.isMoveableSubStack()}}}},isFree:function(){return this===this.stack.last()},isMoveableSubStack:function(){var i=this.stack.cards;var j=i.indexOf(this);var g=i.length;if(j>1&&!i[j-2].isFaceDown){return false}if(this.rank===13){return(g-j<14)}var h=13;if(j>0&&!i[j-1].isFaceDown){h=i[j-1].rank}if(h!=13){return false}return(g-j<12)},createProxyStack:function(){if(this.isFaceDown){this.proxyStack=null;return null}if(!this.playable()){return null}var h=instance(this.stack,{proxy:true,stack:this.stack}),l=h.cards,j,k,n,g;h.cards=[];h.push(this,true);n=l.indexOf(this);g=l.length;for(k=n+1;k<g;k++){j=l[k];if(h.validProxy(j)){h.push(j,true)}else{break}}this.proxyStack=k===g?h:null;return this.proxyStack},validTarget:function(h){var i,g;if(h.field){i=h.last();g=h}else{i=h;g=h.stack}if(!i){return this.rank===13}if(i.isFaceDown){return false}switch(g.field){case"tableau":case"foundation":if(i.rank===13){return this.rank!==13}else{interval=e(g);return(this.rank%13)===(i.rank+interval)%13}default:return false}}})});f.Array.each(b.fields,function(g){b[g].Stack=instance(b.Stack)},true);f.mix(b.Stack,{updateCardsStyle:function(){var g=this.field;this.eachCard(function(h){if(h.playable()){h.node.addClass("playable")}else{h.node.removeClass("playable")}})}},true);f.mix(b.Stack,{validTarget:function(g){switch(g.field){case"tableau":case"foundation":if(g.cards&&g.cards.last()){return g.cards.last().rank===13}else{return this.first().rank===13}default:return false}}},true);f.mix(b.Tableau.Stack,{setCardPosition:function(g){var h=this.cards.last(),j=h?h.top+h.rankHeight:this.top,i=this.left;g.left=i;g.top=j}},true);f.mix(b.Foundation.Stack,{setCardPosition:function(g){var h=this.cards.last(),j=h?h.top+h.rankHeight:this.top,i=this.left;g.left=i;g.top=j}},true);f.mix(b.Waste.Stack,{setCardPosition:function(g){var h=this.cards.last(),j=h?h.top+h.rankHeight:this.top,i=this.left;g.left=i;g.top=j}},true);f.mix(b.Waste.Stack,{maxStackHeight:function(){return d.Card.height*4.8}},true);f.mix(b.Deck.Stack,{createNode:function(){d.Stack.createNode.call(this);this.node.on("click",d.Events.clickEmptyDeck);this.node.addClass("playable")}},true)},"0.0.1",{requires:["solitaire","klondike"]});YUI.add("bisley",function(b){var a=b.Solitaire,c=b.Solitaire.Bisley=instance(a,{fields:["Foundation","Tableau"],deal:function(){var g,d,e=this.deck,l=e.cards,k=this.tableau.stacks,f=this.foundation.stacks,j=[],h=0;while(j.length<4){g=l[h];if(g.rank===1){l.splice(h,1);j.push(g)}else{h++}}for(h=0;h<4;h++){g=j[h];g.faceUp();f[h].push(g);f[h+4].suit=g.suit}d=4;while(g=e.pop()){k[d].push(g);g.faceUp();g.flipPostMove(0);if(++d>=k.length){d=0}}e.createStack()},Stack:instance(a.Stack),Foundation:{stackConfig:{total:8,layout:{hspacing:1.25,top:function(){return a.Card.height*1.25},left:function(){return a.Card.width*5.75}}},field:"foundation"},Tableau:{stackConfig:{total:13,layout:{hspacing:1.25,top:function(){return a.Card.height*2.75},left:0}},field:"tableau"},Card:instance(a.Card,{validTarget:function(d){var e=d.last();switch(d.field){case"tableau":if(!e){return false}else{return e.suit===this.suit&&Math.abs(e.rank-this.rank)===1}break;case"foundation":if(!e){return this.rank===13&&this.suit===d.suit}else{return e.suit===this.suit&&Math.abs(e.rank-this.rank)===1}break;default:return false}}})});b.Array.each(c.fields,function(d){c[d].Stack=instance(c.Stack)});b.mix(c.Stack,{images:{foundation:"freeslot.png"},validCard:function(){return false}},true);b.mix(c.Foundation.Stack,{suit:null,layout:function(e,d){a.Stack.layout.call(this,e,d);if(d>=4){this.left-=a.Card.width*5;this.top-=a.Card.height*1.25}}},true);b.mix(c.Tableau.Stack,{setCardPosition:function(d){var e=this.cards.last(),g=e?e.top+e.rankHeight:this.top,f=this.left;d.left=f;d.top=g},layout:function(e,d){a.Stack.layout.call(this,e,d);if(d<4){this.top+=a.Card.rankHeight}}},true);b.mix(c.Deck.Stack,{images:{deck:null}},true)},"0.0.1",{requires:["solitaire","util"]});YUI.add("king-albert",function(d){var b=d.Solitaire,c=b.Util,a=d.Solitaire.KingAlbert=instance(b,{fields:["Foundation","Tableau","Reserve"],height:function(){return this.Card.base.height*5.3},maxStackHeight:function(){return this.Card.height*2.75},deal:function(){var h,e,k,g=this.deck,j=g.cards,i=this.tableau.stacks,f=this.reserve.stacks;for(k=0;k<9;k++){for(e=k;e<9;e++){h=g.pop();i[e].push(h);h.faceUp()}}c.flipStacks(h);for(e=0;e<7;e++){h=g.pop();f[e].push(h);h.faceUp();h.flipPostMove(2000)}},Stack:instance(b.Stack),Foundation:{stackConfig:{total:4,layout:{hspacing:1.25,top:0,left:function(){return b.Card.width*6.25}}},field:"foundation"},Tableau:{stackConfig:{total:9,layout:{hspacing:1.25,top:function(){return b.Card.height*1.5},left:0}},field:"tableau"},Reserve:{stackConfig:{total:7,layout:{hspacing:0.4,top:function(){return b.Card.height*4.4},left:function(){return b.Card.width*1.25}}},field:"reserve"},Card:instance(b.Card,{playable:function(){switch(this.stack.field){case"tableau":return this.createProxyStack();case"reserve":return true;default:return false}},createProxyStack:function(){return b.Card.createProxyStack.call(this)},validTarget:function(e){var f=e.last();switch(e.field){case"tableau":if(!f){return true}else{return f.color!==this.color&&f.rank===this.rank+1}break;case"foundation":if(!f){return this.rank===1}else{return f.suit===this.suit&&f.rank===this.rank-1}break;default:return false}}})});d.Array.each(a.fields,function(e){a[e].Stack=instance(a.Stack)});d.mix(a.Stack,{images:{foundation:"freeslot.png",tableau:"freeslot.png"},validCard:function(e){return this.cards.length<Math.pow(2,c.freeTableaus().length)},validTarget:function(e){if(e.field!="tableau"){return false}var f=c.freeTableaus().length;if(!e.first()){f--}return this.cards.length<=Math.pow(2,f)}},true);d.mix(a.Reserve.Stack,{setCardPosition:function(e){b.Stack.setCardPosition.call(this,e);e.zIndex=this.index()}},true);d.mix(a.Tableau.Stack,{setCardPosition:function(e){var f=this.cards.last(),h=f?f.top+f.rankHeight:this.top,g=this.left;e.left=g;e.top=h}},true)},"0.0.1",{requires:["solitaire","util"]});(function(){function s(N){var O;return function(){if(!O){O=c.one(N)}return O}}var F={name:"Klondike",game:null},A=YUI({fetchCSS:false,bootstrap:false}),c,r=s("body"),E={accordion:"Accordion",acesup:"AcesUp",agnes:"Agnes",alternations:"Alternations",bakersdozen:"BakersDozen",bakersgame:"BakersGame",baroness:"Baroness",bisley:"Bisley",doubleklondike:"DoubleKlondike",calculation:"Calculation",canfield:"Canfield",eightoff:"Eightoff","king-albert":"KingAlbert",klondike:"Klondike",klondike1t:"Klondike1T",thefan:"TheFan","flower-garden":"FlowerGarden","forty-thieves":"FortyThieves",freecell:"Freecell",golf:"Golf","grandfathers-clock":"GClock",labellelucie:"LaBelleLucie","monte-carlo":"MonteCarlo",pyramid:"Pyramid","russian-solitaire":"RussianSolitaire","simple-simon":"SimpleSimon","seven-toes":"SevenToes",scorpion:"Scorpion",spider:"Spider",spider1s:"Spider1S",spider2s:"Spider2S",spiderette:"Spiderette","tri-towers":"TriTowers","will-o-the-wisp":"WillOTheWisp",yukon:"Yukon"},G=["json","tabview","util","auto-turnover","statistics","win-display","solver-freecell","solitaire-autoplay","solitaire-ios","display-seed-value","save-manager","analytics"],j={Accordion:"Accordion",AcesUp:"Aces Up",Agnes:"Agnes",Alternations:"Alternations",BakersDozen:"Baker's Dozen",BakersGame:"Baker's Game",Baroness:"Baroness",Bisley:"Bisley",Calculation:"Calculation",Canfield:"Canfield",DoubleKlondike:"Double Klondike",Eightoff:"Eight Off",Klondike:"Klondike",Klondike1T:"Klondike (Vegas style)",TheFan:"The Fan",FlowerGarden:"Flower Garden",FortyThieves:"Forty Thieves",Freecell:"Freecell",Golf:"Golf",GClock:"Grandfather's Clock",LaBelleLucie:"La Belle Lucie",KingAlbert:"King Albert",MonteCarlo:"Monte Carlo",Pyramid:"Pyramid",RussianSolitaire:"Russian Solitaire",Scorpion:"Scorpion",SevenToes:"Seven Toes",SimpleSimon:"Simple Simon",Spider:"Spider",Spider1S:"Spider (1 Suit)",Spider2S:"Spider (2 Suit)",Spiderette:"Spiderette",WillOTheWisp:"Will O' The Wisp",TriTowers:"Tri Towers",Yukon:"Yukon"},C=(function(){var P=null,O={position:"absolute",display:"none",backgroundColor:"#000",opacity:0.7,top:0,left:0,width:0,height:0,zIndex:1000},N=function(){if(P===null){P=c.Node.create("<div>");P.setStyles(O);r().append(P)}return P};return{show:function(){var Q=N();O.display="block";O.width=Q.get("winWidth");O.height=Q.get("winHeight");Q.setStyles(O)},hide:function(){O.display="none";N().setStyles(O)},resize:function(){if(O.display==="block"){this.show()}}}}()),J=(function(){var R=s("#rules-popup"),P,N,Q=false;function O(){var T=c.one("#"+F.name),S;if(!T){for(m in E){if(E[m]===F.name){T=c.one("#"+m);break}}}return T}return{show:function(){P=O().one(".description");R().one("button").insert(P,"before");R().removeClass("hidden");C.show();Q=true},hide:function(){if(!(Q&&P)){return}O().appendChild(P);R().addClass("hidden");C.hide();Q=false}}})(),b={selected:null,fade:false,init:function(){this.refit()},node:s("#game-chooser"),refit:function(){var O=c.one("#game-chooser"),N=O.get("winHeight");O.setStyle("min-height",N)},show:function(N){if(!this.selected){this.select(F.name)}if(N){C.show();this.fade=true}this.node().addClass("show").append(w.node());r().addClass("scrollable")},hide:function(){if(this.fade){C.hide()}this.node().removeClass("show");c.fire("gamechooser:hide",this);r().removeClass("scrollable").append(w.node())},choose:function(){if(!this.selected){return}this.hide();k(this.selected)},select:function(N){var P=c.one("#"+N+"> div"),O=this.selected;if(O!==N){this.unSelect()}if(P){this.selected=N;new c.Node(document.getElementById(N)).addClass("selected")}if(O&&O!==N){c.fire("gamechooser:select",this)}},unSelect:function(){if(!this.selected){return}new c.Node(document.getElementById(this.selected)).removeClass("selected");this.selected=null}},L={selector:"#options-chooser",initInputs:function(){var O,N=p.properties,P;for(O in N){if(!N.hasOwnProperty(O)){continue}P=N[O].get();if(typeof P==="boolean"){document.getElementById(O+"-toggle").checked=P}}},attachEvents:function(){c.delegate("change",function(P){var N=this.get("id").replace("-toggle",""),O=p.properties[N];if(O){O.set(this.get("checked"));p.save()}},this.selector,"input[type=checkbox]");c.delegate("click",function(){w.load(this.getData("item"));p.save()},"#background-options .backgrounds",".background");c.delegate("click",function(N){v.load(this.getData("item"));z.preload(false);z.loaded(o);p.save()},"#graphics-options .cards",".card-preview")},element:(function(){var N;function O(V,P,W){var S,Q=V.all,U=V.current,T=c.one(P),R;for(S in Q){if(!Q.hasOwnProperty(S)){continue}V.current=S;R=W(V).setData("item",S);if(S===U){R.addClass("selected")}T.append(R)}V.current=U}return function(){var P;if(!N){N=c.one(L.selector);P=new c.TabView({srcNode:N.one(".tabview")});P.render();L.initInputs();L.attachEvents();O(v,"#graphics-options .cards",function(Q){return c.Node.create(c.Lang.sub("<li class=card-preview><img src={base}/facedown.png><img src={base}/h12.png></li>",{base:Q.basePath(90)}))});O(w,"#background-options .backgrounds",function(Q){return c.Node.create("<li class=background></li>").setStyle("backgroundImage","url("+Q.all[Q.current].image+")")})}return N}}()),show:function(){C.show();this.element().removeClass("hidden")},hide:function(){C.hide();this.element().addClass("hidden")}},p={properties:{cardTheme:{set:function(N){v.load(N)},get:function(){return v.current||v.defaultTheme}},autoplay:{set:function(O){var N=c.Solitaire.Autoplay;O?N.enable():N.disable()},get:function(){return c.Solitaire.Autoplay.isEnabled()}},animateCards:{set:function(N){c.Solitaire.Animation.animate=N},get:function(){return c.Solitaire.Animation.animate}},autoFlip:{set:function(O){var N=c.Solitaire.AutoTurnover;O?N.enable():N.disable()},get:function(){return c.Solitaire.AutoTurnover.isEnabled()}},enableSolver:{set:function(N){var O=c.Solitaire.Solver.Freecell;N?O.enable():O.disable()},get:function(){return c.Solitaire.Solver.Freecell.isEnabled()}},background:{set:function(N){w.load(N)},get:function(){return w.current||w.defaultBackground}}},load:function(){var N;N=localStorage.options;if(!N){N=c.Cookie.get("full-options");c.Cookie.remove("full-options")}try{c.JSON.parse(N,this.set.bind(this))}catch(O){}if(!v.current){v.load()}if(!w.current){w.load()}},save:function(){localStorage.options=c.JSON.stringify(u(this.properties,function(N,O){return O.get()}))},set:function(N,O){var P=this.properties[N];if(P){P.set(O)}}},v={all:{air:{sizes:[141],141:{hiddenRankHeight:17,rankHeight:55,dimensions:[141,199]}},ancient_egyptians:{sizes:[148],148:{hiddenRankHeight:17,rankHeight:50,dimensions:[148,200]}},dondorf:{sizes:[61,79,95,122],61:{hiddenRankHeight:7,rankHeight:25,dimensions:[61,95]},79:{hiddenRankHeight:10,rankHeight:32,dimensions:[79,123]},95:{hiddenRankHeight:12,rankHeight:38,dimensions:[95,148]},122:{hiddenRankHeight:15,rankHeight:48,dimensions:[122,190]}},"jolly-royal":{sizes:[144],144:{hiddenRankHeight:20,rankHeight:52,dimensions:[144,200]}},paris:{sizes:[131],131:{hiddenRankHeight:18,rankHeight:48,dimensions:[131,204]}}},current:null,defaultTheme:"jolly-royal",snapToSize:function(N){var P=this.all[this.current],O=P.sizes;N=l(N||0,O[0],O[O.length-1])>>>0;while(c.Array.indexOf(O,N)===-1){N++}return N},basePath:function(N){return this.current+"/"+this.snapToSize(N)},load:function(N){var P=c.Solitaire,Q=P.Card.base,O;if(!(N in this.all)){N=this.defaultTheme}this.current=N;O=this.all[N].sizes;this.set(O[O.length-1])},set:function(N){var O=this.all[this.current][N];c.mix(c.Solitaire.Card.base,{theme:this.basePath(N),hiddenRankHeight:O.hiddenRankHeight,rankHeight:O.rankHeight,width:O.dimensions[0],height:O.dimensions[1]},true)}},w={all:{green:{image:"green.jpg",size:"100%"},vintage:{image:"backgrounds/grungy-vintage.jpg",repeat:true},circles:{image:"backgrounds/retro-circles-army-green.jpg",repeat:true},watercolor:{image:"backgrounds/watercolor-grunge-ripe-apricot.jpg",size:"cover"},heart:{image:"backgrounds/grunge-hearts-maroon-copper.jpg",size:"cover"}},current:null,defaultBackground:"green",stylesheet:null,load:function(N){if(!(N in this.all)){N=this.defaultBackground}this.current=N;this.set()},set:function(){var N=this.all[this.current],O;O=this.node();if(N.repeat){this.imageNode().hide();this.node().setStyle("backgroundImage","url("+N.image+")")}else{this.node().setStyle("backgroundImage","none");this.imageNode().set("src",N.image).show()}},resize:function(){var Q=this.all[this.current],R=this.imageNode(),N=R.get("width"),V=R.get("height"),O=R.get("winWidth"),P=R.get("winHeight"),U,T,S;if(Q.repeat){return}if(Q.size==="cover"){U=N/O;T=V/P;S=U<T?U:T;R.setAttrs({width:Math.ceil(N/S),height:Math.ceil(V/S)})}else{if(Q.size==="100%"){R.setAttrs({width:O,height:P})}}R.show()},imageNode:s("#background-image"),node:function(){var N=c.one("#background"),O;if(!N){N=c.Node.create("<div id=background>").appendTo(r());O=c.Node.create("<img id=background-image>");O.set("draggable",false);O.on("load",this.resize.bind(this));N.append(O)}return N}};function l(P,N,O){return Math.max(Math.min(P,O),N)}function u(P,Q){var N={},O;for(O in P){if(!P.hasOwnProperty(O)){continue}N[O]=Q.call(P,O,P[O])}return N}function t(){var O=G.slice(),N;for(N in E){if(E.hasOwnProperty(N)){O.unshift(N)}}return O}function e(N){c=N;a();c.on("domready",B)}function q(){b.select(this._node.id);b.choose()}var d=s("#about-popup"),H=s("#stats-popup"),y=s("#win-display");function i(N){c.fire("popup",N)}var g={promptNode:s("#confirmation-prompt"),node:s("#confirmation"),affirmButton:s("#confirmation-affirm"),denyButton:s("#confirmation-deny"),active:false,attachEvents:function(N){this.affirmButton().once("click",function(){N();this.hide()}.bind(this));this.denyButton().once("click",function(){this.hide()}.bind(this))},resize:function(){if(!this.active){return}this.node().setStyles({width:this.node().get("winWidth")+"px",height:this.node().get("winHeight")+"px"})},hide:function(){this.active=false;this.node().addClass("hidden")},show:function(N,O){this.active=true;this.attachEvents(O);this.promptNode().set("text",N);this.node().removeClass("hidden");this.resize()}};function n(){var N=function(){b.hide();L.hide();J.hide();H().addClass("hidden");d().addClass("hidden");C.hide()};c.on("click",I,c.one("#restart"));c.on("click",i.partial("GameChooser"),c.one("#choose-game"));c.on("click",i.partial("OptionsChooser"),c.one("#choose-options"));c.on("click",i.partial("Rules"),c.one("#rules"));c.on("click",i.partial("About"),c.one("#about"));c.on("click",function(){F.game.undo()},c.one("#undo"));c.on("click",f,c.one("#new-deal"));c.on("click",c.Solitaire.Statistics.statsDisplay,c.one("#stats"));c.on("submit",function(){c.Solitaire.Analytics.track("Donations","Click","Paypal button")},c.one("#donate"));c.on("click",M,c.one(".chromestore"));c.delegate("click",q,"#descriptions","li");c.on("click",N,".close-chooser");c.one("document").on("keydown",function(O){if(O.keyCode===27){N()}});c.on("afterSetup",function(){F.game.stationary(function(){o()})});c.on("Application|popup",function(O){y().addClass("hidden");switch(O){case"GameChooser":b.show(false);break;case"OptionsChooser":L.show();break;case"About":d().removeClass("hidden");C.show();break;case"Rules":J.show();break;case"Stats":H().removeClass("hidden");C.show();break}});c.on("fieldResize",function(Q,O,P){F.game.resize(Q)});h()}function h(){var P,N=250,O;if(window.addEventListener){O="addEventListener"}else{if(window.attachEvent){O="attachEvent"}}window[O](c.Solitaire.Application.resizeEvent,function(){clearTimeout(P);P=setTimeout(o,N)},false)}function o(){var O=F.game,R=O.container(),S=O.padding,T=O.offset,Q=R.get("winWidth")-S.x,N=R.get("winHeight")-S.y,P=1;c.Solitaire.Application.windowHeight=N;P=Math.min((Q-normalize(T.left))/O.width(),(N-normalize(T.top))/O.height());c.fire("fieldResize",P,Q,N);b.refit();C.resize();w.resize();g.resize()}function k(N){F.name=N;F.game=x(N);f()}function x(N){return c.Solitaire[E[N]]||c.Solitaire[N]}function B(){var N=c.Solitaire.SaveManager.getSavedGame();if(N.name!==""){F.name=N.name}n();p.load();z.preload();z.loaded(function(){D();if(N.serialized!==""){K();F.game=x(F.name);try{F.game.cleanup();F.game.loadGame(N.serialized)}catch(O){k(F.name)}}else{k(F.name)}});b.init()}function K(){c.all(".stack, .card").remove()}function I(){var O=c.Solitaire.SaveManager.getSavedGame("initial-game"),N=F.game;K();N.cleanup();if(O.serialized!==""){N.loadGame(O.serialized)}else{N.newGame()}}function f(){var N=F.game;K();N.cleanup();N.newGame()}function a(){c.Solitaire.Application={windowHeight:0,resizeEvent:"resize",GameChooser:b,Confirmation:g,newGame:f,nameMap:j,currentTheme:function(){return v.current}}}function M(){c.one(".chromestore").addClass("hidden");localStorage["disable-chromestore-link"]="true"}function D(){var N="disable-chromestore-link";if(c.UA.chrome&&(localStorage[N]!=="true"||!c.Cookie.get(N,Boolean))){c.one(".chromestore").removeClass("hidden")}}var z={loadingCount:0,showFade:true,loaded:function(N){if(this.loadingCount){setTimeout(function(){this.loaded(N)}.bind(this),100)}else{c.one(".loading").addClass("hidden");N();if(this.showFade){C.hide()}}},load:function(O){var N=new Image;N.onload=function(){--this.loadingCount}.bind(this);N.onerror=function(){--this.loadingCount}.bind(this);N.src=O;this.loadingCount++},preload:function(P){var O,N=["agnes","flower-garden","forty-thieves","freecell","gclock","golf","klondike1t","klondike","montecarlo","pyramid","scorpion","spider1s","spider2s","spiderette","spider","tritowers","will-o-the-wisp","yukon"];c.Array.each(["s","h","c","d"],function(Q){for(O=1;O<=13;O++){this.load(c.Solitaire.Card.base.theme+"/"+Q+O+".png")}},this);this.load(c.Solitaire.Card.base.theme+"/facedown.png");this.load(c.Solitaire.Card.base.theme+"/freeslot.png");c.Array.each(N,function(Q){this.load("layouts/mini/"+Q+".png")},this);this.showFade=P!==false;if(this.showFade){C.show()}c.one(".loading").removeClass("hidden")}};A.use.apply(A,t().concat(e))}());